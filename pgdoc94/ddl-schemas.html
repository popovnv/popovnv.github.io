<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Схемы</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="Документация по PostgreSQL 9.4.1"
HREF="index.html"><LINK
REL="UP"
TITLE="Определение данных"
HREF="ddl.html"><LINK
REL="PREVIOUS"
TITLE="Права"
HREF="ddl-priv.html"><LINK
REL="NEXT"
TITLE="Наследование"
HREF="ddl-inherit.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=UTF-8"><META
NAME="creation"
CONTENT="2016-04-12T07:56:57"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>Документация по PostgreSQL 9.4.1</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Права"
HREF="ddl-priv.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="ddl.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Глава 5. Определение данных</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Наследование"
HREF="ddl-inherit.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DDL-SCHEMAS"
>5.7. Схемы</A
></H1
><P
>Кластер баз данных <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> содержит один или несколько именованных экземпляров баз. На уровне кластера создаются пользователи и группы, но данные могут относиться только к базам данных. При этом в рамках одного подключения к серверу можно обращаться к данным только одной базы данных, указанной при установлении соединения.</P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Замечание: </B
>Пользователи кластера не обязательно будут иметь доступ ко всем базам данным этого кластера. То, что пользователи создаются на уровне кластера, означает только, что в нём не может быть двух пользователей <TT
CLASS="LITERAL"
>joe</TT
> в разных базах данных, хотя система позволяет ограничить доступ <TT
CLASS="LITERAL"
>joe</TT
> только некоторыми базами данных.</P
></BLOCKQUOTE
></DIV
><P
>База данных содержит одну или несколько именованных <I
CLASS="FIRSTTERM"
>схем</I
>, которые в свою очередь содержат таблицы. Схемы также содержат именованные объекты других видов, включая типы данных, функции и операторы. Одно и то же имя объекта можно свободно использовать в разных схемах, например и <TT
CLASS="LITERAL"
>schema1</TT
>, и <TT
CLASS="LITERAL"
>myschema</TT
> могут содержать таблицы с именем <TT
CLASS="LITERAL"
>mytable</TT
>. В отличие от баз данных, схемы не ограничивают доступ к данным: пользователь может обращаться к объектам в любой схеме текущей базы данных, если ему назначены соответствующие права.</P
><P
>Есть несколько возможных объяснений, для чего стоит применять схемы: <P
></P
></P><UL
><LI
><P
>Чтобы одну базу данных могли использовать несколько пользователей, независимо друг от друга.</P
></LI
><LI
><P
>Чтобы объединить объекты базы данных в логические группы для облегчения управления ими.</P
></LI
><LI
><P
>Чтобы в одной базе сосуществовали разные приложения, и при этом не возникало конфликтов имён.</P
></LI
></UL
><P> Схемы в некоторым смысле подобны каталогам в операционной системе, но они не могут быть вложенными.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DDL-SCHEMAS-CREATE"
>5.7.1. Создание схемы</A
></H2
><P
>Для создания схемы используется команда <A
HREF="sql-createschema.html"
>CREATE SCHEMA</A
>. При этом вы определяете имя схемы по своему выбору, например так: </P><PRE
CLASS="PROGRAMLISTING"
>CREATE SCHEMA myschema;</PRE
><P></P
><P
>Чтобы создать объекты в схеме или обратиться к ним, указывайте <I
CLASS="FIRSTTERM"
>полное имя</I
>, состоящее из имён схемы и объекта, разделённых точкой: </P><PRE
CLASS="SYNOPSIS"
><TT
CLASS="REPLACEABLE"
><I
>схема</I
></TT
><TT
CLASS="LITERAL"
>.</TT
><TT
CLASS="REPLACEABLE"
><I
>таблица</I
></TT
></PRE
><P> Этот синтаксис работает везде, где ожидается имя таблицы, включая команды модификации таблицы и команды обработки данных, обсуждаемые в следующих главах. (Для краткости мы будем говорить только о таблицах, но всё это распространяется и на другие типы именованных объектов, например, типы и функции.)</P
><P
>Есть ещё более общий синтаксис </P><PRE
CLASS="SYNOPSIS"
><TT
CLASS="REPLACEABLE"
><I
>база_данных</I
></TT
><TT
CLASS="LITERAL"
>.</TT
><TT
CLASS="REPLACEABLE"
><I
>схема</I
></TT
><TT
CLASS="LITERAL"
>.</TT
><TT
CLASS="REPLACEABLE"
><I
>таблица</I
></TT
></PRE
><P>но в настоящее время он поддерживается только для формального соответствия стандарту SQL. Если вы указываете базу данных, это может быть только база данных, к которой вы подключены.</P
><P
>Таким образом, создать таблицу в новой схеме можно так: </P><PRE
CLASS="PROGRAMLISTING"
>CREATE TABLE myschema.mytable (
 ...
);</PRE
><P></P
><P
>Чтобы удалить пустую схему (не содержащую объектов), выполните: </P><PRE
CLASS="PROGRAMLISTING"
>DROP SCHEMA myschema;</PRE
><P> Удалить схему со всеми содержащимися в ней объектами можно так: </P><PRE
CLASS="PROGRAMLISTING"
>DROP SCHEMA myschema CASCADE;</PRE
><P> Стоящий за этим общий механизм описан в <A
HREF="ddl-depend.html"
>Разделе 5.12</A
>.</P
><P
>Часто бывает нужно создать схему, владельцем которой будет другой пользователь (это один из способов ограничения пользователей пространствами имён). Сделать это можно так: </P><PRE
CLASS="PROGRAMLISTING"
>CREATE SCHEMA <TT
CLASS="REPLACEABLE"
><I
>имя_схемы</I
></TT
> AUTHORIZATION <TT
CLASS="REPLACEABLE"
><I
>имя_пользователя</I
></TT
>;</PRE
><P> Вы даже можете опустить имя схемы, в этом случае именем схемы станет имя пользователя. Как это можно применять, описано в <A
HREF="ddl-schemas.html#DDL-SCHEMAS-PATTERNS"
>Подразделе 5.7.6</A
>.</P
><P
>Схемы с именами, начинающимися с <TT
CLASS="LITERAL"
>pg_</TT
>, являются системными; пользователям не разрешено использовать такие имена.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DDL-SCHEMAS-PUBLIC"
>5.7.2. Схема public</A
></H2
><P
>До этого мы создавали таблицы, не указывая никакие имена схем. По умолчанию такие таблицы (и другие объекты) автоматически помещаются в схему <SPAN
CLASS="QUOTE"
>"public"</SPAN
>. Она содержится во всех создаваемых базах данных. Таким образом, команда: </P><PRE
CLASS="PROGRAMLISTING"
>CREATE TABLE products ( ... );</PRE
><P> эквивалентна: </P><PRE
CLASS="PROGRAMLISTING"
>CREATE TABLE public.products ( ... );</PRE
><P></P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DDL-SCHEMAS-PATH"
>5.7.3. Путь поиска схемы</A
></H2
><P
>Везде писать полные имена утомительно, и часто всё равно лучше не привязывать приложения к конкретной схеме. Поэтому к таблицам обычно обращаются по <I
CLASS="FIRSTTERM"
>неполному имени</I
>, состоящему просто из имени таблицы. Система определяет, какая именно таблица подразумевается, используя <I
CLASS="FIRSTTERM"
>путь поиска</I
>, который представляет собой список просматриваемых схем. Подразумеваемой таблицей считается первая подходящая таблица, найденная в схемах пути. Если подходящая таблица не найдена, возникает ошибка, даже если таблица с таким именем есть в других схемах базы данных.</P
><P
>Первая схема в пути поиска называется текущей. Эта схема будет использоваться не только при поиске, но и при создании объектов &mdash; она будет включать таблицы, созданные командой <TT
CLASS="COMMAND"
>CREATE TABLE</TT
> без указания схемы.</P
><P
>Чтобы узнать текущий тип поиска, выполните следующую команду: </P><PRE
CLASS="PROGRAMLISTING"
>SHOW search_path;</PRE
><P> В конфигурации по умолчанию она возвращает: </P><PRE
CLASS="SCREEN"
> search_path
--------------
 "$user",public</PRE
><P> Первый элемент ссылается на схему с именем текущего пользователя. Если такой схемы не существует, ссылка на неё игнорируется. Второй элемент ссылается на схему public, которую мы уже видели.</P
><P
>Первая существующая схема в пути поиска также считается схемой по умолчанию для новых объектов. Именно поэтому по умолчанию объекты создаются в схеме public. При указании неполной ссылки на объект в любом контексте (при модификации таблиц, изменении данных или в запросах) система просматривает путь поиска, пока не найдёт соответствующий объект. Таким образом, в конфигурации по умолчанию неполные имена могут относиться только к объектам в схеме public.</P
><P
>Чтобы добавить в путь нашу новую схему, мы выполняем: </P><PRE
CLASS="PROGRAMLISTING"
>SET search_path TO myschema,public;</PRE
><P> (Мы опускаем компонент <TT
CLASS="LITERAL"
>$user</TT
>, так как здесь в нём нет необходимости.) Теперь мы можем обращаться к таблице без указания схемы: </P><PRE
CLASS="PROGRAMLISTING"
>DROP TABLE mytable;</PRE
><P> И так как <TT
CLASS="LITERAL"
>myschema</TT
> &mdash; первый элемент в пути, новые объекты будут по умолчанию создаваться в этой схеме.</P
><P
>Мы можем также написать: </P><PRE
CLASS="PROGRAMLISTING"
>SET search_path TO myschema;</PRE
><P> Тогда мы больше не сможем обращаться к схеме public, не написав полное имя объекта. Единственное, что отличает схему public от других, это то, что она существует по умолчанию, хотя её так же можно удалить.</P
><P
>В <A
HREF="functions-info.html"
>Разделе 9.25</A
> вы узнаете, как ещё можно манипулировать путём поиска схем.</P
><P
>Как и для имён таблиц, путь поиска аналогично работает для имён типов данных, имён функций и имён операторов. Имена типов данных и функций можно записать в полном виде так же, как и имена таблиц. Если же вам нужно использовать в выражении полное имя оператора, для этого есть специальный способ &mdash; вы должны написать: </P><PRE
CLASS="SYNOPSIS"
><TT
CLASS="LITERAL"
>OPERATOR(</TT
><TT
CLASS="REPLACEABLE"
><I
>схема</I
></TT
><TT
CLASS="LITERAL"
>.</TT
><TT
CLASS="REPLACEABLE"
><I
>оператор</I
></TT
><TT
CLASS="LITERAL"
>)</TT
></PRE
><P> Такая запись необходима для избежания синтаксической неоднозначности. Пример такого выражения: </P><PRE
CLASS="PROGRAMLISTING"
>SELECT 3 OPERATOR(pg_catalog.+) 4;</PRE
><P> На практике пользователи часто полагаются на путь поиска, чтобы не приходилось писать такие замысловатые конструкции.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DDL-SCHEMAS-PRIV"
>5.7.4. Схемы и права</A
></H2
><P
>По умолчанию пользователь не может обращаться к объектам в чужих схемах. Чтобы изменить это, владелец схемы должен дать пользователю право <TT
CLASS="LITERAL"
>USAGE</TT
> для данной схемы. Чтобы пользователи могли использовать объекты схемы, может понадобиться назначить дополнительные права на уровне объектов.</P
><P
>Пользователю также можно разрешить создавать объекты в не принадлежащей ему схеме. Для этого ему нужно дать право <TT
CLASS="LITERAL"
>CREATE</TT
> в требуемой схеме. Заметьте, что по умолчанию все имеют права <TT
CLASS="LITERAL"
>CREATE</TT
> и <TT
CLASS="LITERAL"
>USAGE</TT
> в схеме <TT
CLASS="LITERAL"
>public</TT
>. Благодаря этому все пользователи могут подключаться к заданной базе данных и создавать объекты в её схеме <TT
CLASS="LITERAL"
>public</TT
>. Если вас это не устраивает, вы можете отозвать это право: </P><PRE
CLASS="PROGRAMLISTING"
>REVOKE CREATE ON SCHEMA public FROM PUBLIC;</PRE
><P> (Первое слово <SPAN
CLASS="QUOTE"
>"public"</SPAN
> обозначает схему, а второе <SPAN
CLASS="QUOTE"
>"public"</SPAN
> подразумевает <SPAN
CLASS="QUOTE"
>"все пользователи"</SPAN
>. В первом случае это идентификатор, а во втором &mdash; ключевое слово, поэтому оно написано в разном регистре; вспомните рекомендации из <A
HREF="sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS"
>Подраздела 4.1.1</A
>.)</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DDL-SCHEMAS-CATALOG"
>5.7.5. Схема системного каталога</A
></H2
><P
>В дополнение к схеме <TT
CLASS="LITERAL"
>public</TT
> и схемам, создаваемым пользователями, любая база данных содержит схему <TT
CLASS="LITERAL"
>pg_catalog</TT
>, в которой находятся системные таблицы и все встроенные типы данных, функции и операторы. <TT
CLASS="LITERAL"
>pg_catalog</TT
> фактически всегда является частью пути поиска. Если даже эта схема не добавлена в путь явно, она неявно просматривается <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>до</I
></SPAN
> всех схем, указанных в пути. Так обеспечивается доступность встроенных имён при любых условиях. Однако вы можете явным образом поместить <TT
CLASS="LITERAL"
>pg_catalog</TT
> в конец пути поиска, если вам нужно, чтобы пользовательские имена переопределяли встроенные.</P
><P
>Так как имена системных таблиц начинаются с <TT
CLASS="LITERAL"
>pg_</TT
>, такие имена лучше не использовать во избежание конфликта имён, возможного при появлении в будущем системной таблицы с тем же именем, что и ваша. (С путём поиска по умолчанию неполная ссылка будет воспринята как обращение к системной таблице.) Системные таблицы будут и дальше содержать в имени приставку <TT
CLASS="LITERAL"
>pg_</TT
>, так что они не будут конфликтовать с неполными именами пользовательских таблиц, если пользователи со своей стороны не будут использовать приставку <TT
CLASS="LITERAL"
>pg_</TT
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DDL-SCHEMAS-PATTERNS"
>5.7.6. Шаблоны использования</A
></H2
><P
>Схемам можно найти множество применений. Вот лишь некоторые шаблоны их использования, рекомендуемые и легко реализуемые в конфигурации по умолчанию: <P
></P
></P><UL
><LI
><P
>Если вы явно не создаёте какие-либо схемы, все пользователи будут неявно обращаться к схеме public. Таким образом система ведёт себя так, как если бы схем не было вообще. Эта конфигурация в основном рекомендуется, когда в базе данных есть всего один или несколько сотрудничающих пользователей. Она также позволяет легко мигрировать из среды, где схемы не поддерживаются.</P
></LI
><LI
><P
>Вы можете создать отдельные схемы для каждого пользователя, назвав их именами пользователей. Вспомните, путь поиска по умолчанию начинается с <TT
CLASS="LITERAL"
>$user</TT
>, что интерпретируется как имя пользователя. Таким образом, если у пользователя будет своя схема, по умолчанию он будет обращаться к ней.</P
><P
>Если вы реализуете этот подход, вы, возможно, также захотите запретить доступ к схеме public (или даже удалить её), чтобы пользователи не выходили за рамки своих схем.</P
></LI
><LI
><P
>В отдельные схемы также можно устанавливать совместно используемые приложения (таблицы, которые нужны всем, дополнительные функции и т. д.). Не забудьте дать другим пользователям права для доступа к этим схемам. Тогда пользователи смогут обращаться к этим дополнительным объектам по полному имени или при желании добавят эти схемы в свои пути поиска.</P
></LI
></UL
><P></P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DDL-SCHEMAS-PORTABILITY"
>5.7.7. Переносимость</A
></H2
><P
>Стандарт SQL не поддерживает обращение в одной схеме к разным объектам, принадлежащим разным пользователям. Более того, в ряде реализаций СУБД нельзя создавать схемы с именем, отличным от имени владельца. На практике, в СУБД, реализующих только базовую поддержку схем согласно стандарту, концепции пользователя и схемы очень близки. Таким образом, многие пользователи полагают, что полное имя на самом деле образуется как <TT
CLASS="LITERAL"
><TT
CLASS="REPLACEABLE"
><I
>имя_пользователя</I
></TT
>.<TT
CLASS="REPLACEABLE"
><I
>таблица</I
></TT
></TT
>. И именно так будет вести себя <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>, если вы создадите схемы для каждого пользователя.</P
><P
>В стандарте SQL нет и понятия схемы <TT
CLASS="LITERAL"
>public</TT
>. Для максимального соответствия стандарту использовать схему <TT
CLASS="LITERAL"
>public</TT
> не следует (и возможно, лучше даже удалить её).</P
><P
>Конечно, есть СУБД, в которых вообще не реализованы схемы или пространства имён поддерживают (возможно, с ограничениями) обращения к другим базам данных. Если вам потребуется работать с этими системами, максимальной переносимости вы достигнете, вообще не используя схемы.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="ddl-priv.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Начало</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="ddl-inherit.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Права</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="ddl.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Наследование</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>