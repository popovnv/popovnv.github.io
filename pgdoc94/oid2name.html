<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>oid2name</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="Документация по PostgreSQL 9.4.1"
HREF="index.html"><LINK
REL="UP"
TITLE="Клиентские приложения"
HREF="contrib-prog-client.html"><LINK
REL="PREVIOUS"
TITLE="Клиентские приложения"
HREF="contrib-prog-client.html"><LINK
REL="NEXT"
TITLE="              pgbench
            "
HREF="pgbench.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=UTF-8"><META
NAME="creation"
CONTENT="2016-04-12T07:56:57"></HEAD
><BODY
CLASS="REFENTRY"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>Документация по PostgreSQL 9.4.1</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Клиентские приложения"
HREF="contrib-prog-client.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="contrib-prog-client.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="              pgbench
            "
HREF="pgbench.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="OID2NAME"
></A
>oid2name</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN126144"
></A
><H2
>Название</H2
>oid2name&nbsp;--&nbsp;преобразовать в имена OID и номера файловых узлов в каталоге данных <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
></DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN126148"
></A
><H2
>Синтаксис</H2
><P
><TT
CLASS="COMMAND"
>oid2name</TT
> [                <TT
CLASS="REPLACEABLE"
><I
>параметр</I
></TT
>
              ...]</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN126153"
></A
><H2
>Описание</H2
><P
><SPAN
CLASS="APPLICATION"
>oid2name</SPAN
> — вспомогательная программа, помогающая администраторам исследовать структуру файлов PostgreSQL. Чтобы использовать её, необходимо понимать структуру базы данных на уровне файлов, описанную в <A
HREF="storage.html"
>Главе 59</A
>.</P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Замечание: </B
>Имя <SPAN
CLASS="QUOTE"
>"oid2name"</SPAN
> сложилось исторически и на самом деле вводит в заблуждение, так как чаще всего, используя её, вы будете иметь дело с номерами файловых узлов таблиц (эти номера образуют имена файлов в каталоге баз данных). Необходимо понимать, что OID таблиц отличаются от номеров файловых узлов!</P
></BLOCKQUOTE
></DIV
><P
>Программа <SPAN
CLASS="APPLICATION"
>oid2name</SPAN
> подключается к целевой базе данных и извлекает информацию об OID, файловых узлах и/или именах таблиц. С её помощью можно также просмотреть OID базы данных или табличного пространства.</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN126163"
></A
><H2
>Параметры</H2
><P
><SPAN
CLASS="APPLICATION"
>oid2name</SPAN
> принимает следующие аргументы командной строки: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="OPTION"
>-f</TT
> <TT
CLASS="REPLACEABLE"
><I
>файловый_узел</I
></TT
></DT
><DD
><P
>показать информацию о таблице, к которой относится <TT
CLASS="REPLACEABLE"
><I
>файловый_узел</I
></TT
></P
></DD
><DT
><TT
CLASS="OPTION"
>-i</TT
></DT
><DD
><P
>включить в вывод индексы и последовательности</P
></DD
><DT
><TT
CLASS="OPTION"
>-o</TT
> <TT
CLASS="REPLACEABLE"
><I
>oid</I
></TT
></DT
><DD
><P
>показать информацию о таблице с OID, равным <TT
CLASS="REPLACEABLE"
><I
>oid</I
></TT
></P
></DD
><DT
><TT
CLASS="OPTION"
>-q</TT
></DT
><DD
><P
>не выводить заголовки (полезно для скриптов)</P
></DD
><DT
><TT
CLASS="OPTION"
>-s</TT
></DT
><DD
><P
>показать OID табличных пространств</P
></DD
><DT
><TT
CLASS="OPTION"
>-S</TT
></DT
><DD
><P
>включить в вывод системные объекты (те, что находятся в схемах <TT
CLASS="OPTION"
>information_schema</TT
>, <TT
CLASS="OPTION"
>pg_toast</TT
> и <TT
CLASS="OPTION"
>pg_catalog</TT
>)</P
></DD
><DT
><TT
CLASS="OPTION"
>-t</TT
> <TT
CLASS="REPLACEABLE"
><I
>шаблон_имён_таблиц</I
></TT
></DT
><DD
><P
>показать информацию о таблицах, подпадающих под <TT
CLASS="REPLACEABLE"
><I
>шаблон_имён_таблиц</I
></TT
></P
></DD
><DT
><TT
CLASS="OPTION"
>-V</TT
><BR><TT
CLASS="OPTION"
>--version</TT
></DT
><DD
><P
>вывести версию <SPAN
CLASS="APPLICATION"
>oid2name</SPAN
> и завершиться.</P
></DD
><DT
><TT
CLASS="OPTION"
>-x</TT
></DT
><DD
><P
>вывести дополнительные сведения о каждом показываемом объекте: имя табличного пространства, имя схемы и OID</P
></DD
><DT
><TT
CLASS="OPTION"
>-?</TT
><BR><TT
CLASS="OPTION"
>--help</TT
></DT
><DD
><P
>вывести справку об аргументах командной строки <SPAN
CLASS="APPLICATION"
>oid2name</SPAN
> и завершиться.</P
></DD
></DL
></DIV
><P></P
><P
><SPAN
CLASS="APPLICATION"
>oid2name</SPAN
> также принимает в командной строке следующие аргументы, задающие параметры подключения: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="OPTION"
>-d</TT
> <TT
CLASS="REPLACEABLE"
><I
>database</I
></TT
></DT
><DD
><P
>целевая база данных</P
></DD
><DT
><TT
CLASS="OPTION"
>-H</TT
> <TT
CLASS="REPLACEABLE"
><I
>host</I
></TT
></DT
><DD
><P
>адрес сервера баз данных</P
></DD
><DT
><TT
CLASS="OPTION"
>-p</TT
> <TT
CLASS="REPLACEABLE"
><I
>порт</I
></TT
></DT
><DD
><P
>порт сервера баз данных</P
></DD
><DT
><TT
CLASS="OPTION"
>-U</TT
> <TT
CLASS="REPLACEABLE"
><I
>имя_пользователя</I
></TT
></DT
><DD
><P
>имя пользователя для подключения</P
></DD
><DT
><TT
CLASS="OPTION"
>-P</TT
> <TT
CLASS="REPLACEABLE"
><I
>пароль</I
></TT
></DT
><DD
><P
>пароль (устаревшая возможность &mdash; указание пароля в командной строке угрожает безопасности)</P
></DD
></DL
></DIV
><P></P
><P
>Чтобы получить информацию об определённых таблицах, выберите их с аргументом <TT
CLASS="OPTION"
>-o</TT
>, <TT
CLASS="OPTION"
>-f</TT
> и/или <TT
CLASS="OPTION"
>-t</TT
>. Параметр <TT
CLASS="OPTION"
>-o</TT
> принимает OID, <TT
CLASS="OPTION"
>-f</TT
> — файловый узел, а <TT
CLASS="OPTION"
>-t</TT
> — имя таблицы (на самом деле он принимает шаблон <TT
CLASS="LITERAL"
>LIKE</TT
>, так что в нём можно задать что-то вроде <TT
CLASS="LITERAL"
>foo%</TT
>). Вы можете использовать эти аргументы в любом количестве; в вывод будут включены все объекты, соответствующие любым из этих указаний. Но заметьте, что эти аргументы будут выбирать только объекты в базе данных, заданной ключом <TT
CLASS="OPTION"
>-d</TT
>.</P
><P
>Если аргументы <TT
CLASS="OPTION"
>-o</TT
>, <TT
CLASS="OPTION"
>-f</TT
> и <TT
CLASS="OPTION"
>-t</TT
> отсутствуют, но передаётся <TT
CLASS="OPTION"
>-d</TT
>, будут выведены все таблицы в базе данных с именем, заданным в <TT
CLASS="OPTION"
>-d</TT
>. В этом режиме набором выводимых данных управляют параметры <TT
CLASS="OPTION"
>-S</TT
> и <TT
CLASS="OPTION"
>-i</TT
>.</P
><P
>Если отсутствует и аргумент <TT
CLASS="OPTION"
>-d</TT
>, выводится список OID баз данных. Также можно получить список табличных пространств, передав аргумент <TT
CLASS="OPTION"
>-s</TT
>.</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN126287"
></A
><H2
>Замечания</H2
><P
>Программе <SPAN
CLASS="APPLICATION"
>oid2name</SPAN
> требуется работающий сервер баз данных с исправными системными каталогами. Таким образом, в ситуациях с катастрофическими повреждениями базы данных её использование ограничено.</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN126291"
></A
><H2
>Примеры</H2
><PRE
CLASS="SCREEN"
>$ # Что вообще есть на этом сервере базы данных?
$ oid2name
All databases:
    Oid  Database Name  Tablespace
----------------------------------
  17228       alvherre  pg_default
  17255     regression  pg_default
  17227      template0  pg_default
      1      template1  pg_default

$ oid2name -s
All tablespaces:
     Oid  Tablespace Name
-------------------------
    1663       pg_default
    1664        pg_global
  155151         fastdisk
  155152          bigdisk

$ # Хорошо, давайте взглянем на базу alvherre
$ cd $PGDATA/base/17228

$ # Получим первые 10 объектов базы (отсортированных по размеру) в табличном пространстве по умолчанию
$ ls -lS * | head -10
-rw-------  1 alvherre alvherre 136536064 sep 14 09:51 155173
-rw-------  1 alvherre alvherre  17965056 sep 14 09:51 1155291
-rw-------  1 alvherre alvherre   1204224 sep 14 09:51 16717
-rw-------  1 alvherre alvherre    581632 sep  6 17:51 1255
-rw-------  1 alvherre alvherre    237568 sep 14 09:50 16674
-rw-------  1 alvherre alvherre    212992 sep 14 09:51 1249
-rw-------  1 alvherre alvherre    204800 sep 14 09:51 16684
-rw-------  1 alvherre alvherre    196608 sep 14 09:50 16700
-rw-------  1 alvherre alvherre    163840 sep 14 09:50 16699
-rw-------  1 alvherre alvherre    122880 sep  6 17:51 16751

$ # Поинтересуемся, что за файл 155173...
$ oid2name -d alvherre -f 155173
From database "alvherre":
  Filenode  Table Name
----------------------
    155173    accounts

$ # Можно узнать сразу о нескольких объектах
$ oid2name -d alvherre -f 155173 -f 1155291
From database "alvherre":
  Filenode     Table Name
-------------------------
    155173       accounts
   1155291  accounts_pkey

$ # Можно добавить другие параметры и получить дополнительные подробности с -x
$ oid2name -d alvherre -t accounts -f 1155291 -x
From database "alvherre":
  Filenode     Table Name      Oid  Schema  Tablespace
------------------------------------------------------
    155173       accounts   155173  public  pg_default
   1155291  accounts_pkey  1155291  public  pg_default

$ # Вычислить объём, который занимает на диске каждый объект БД
$ du [0-9]* |
&gt; while read SIZE FILENODE
&gt; do
&gt;   echo "$SIZE       `oid2name -q -d alvherre -i -f $FILENODE`"
&gt; done
16            1155287  branches_pkey
16            1155289  tellers_pkey
17561            1155291  accounts_pkey
...

$ # То же самое, но с сортировкой по размеру
$ du [0-9]* | sort -rn | while read SIZE FN
&gt; do
&gt;   echo "$SIZE   `oid2name -q -d alvherre -f $FN`"
&gt; done
133466             155173    accounts
17561            1155291  accounts_pkey
1177              16717  pg_proc_proname_args_nsp_index
...

$ # Просмотреть содержимое табличных пространств можно в каталоге pg_tblspc
$ cd $PGDATA/pg_tblspc
$ oid2name -s
All tablespaces:
     Oid  Tablespace Name
-------------------------
    1663       pg_default
    1664        pg_global
  155151         fastdisk
  155152          bigdisk

$ # Объекты каких баз данных находятся в табличном пространстве "fastdisk"?
$ ls -d 155151/*
155151/17228/  155151/PG_VERSION

$ # И что это за база данных 17228?
$ oid2name
All databases:
    Oid  Database Name  Tablespace
----------------------------------
  17228       alvherre  pg_default
  17255     regression  pg_default
  17227      template0  pg_default
      1      template1  pg_default

$ # Давайте посмотрим, какие объекты этой базы содержатся в данном табличном пространстве.
$ cd 155151/17228
$ ls -l
total 0
-rw-------  1 postgres postgres 0 sep 13 23:20 155156

$ # Мда, таблица невелика... и что это за таблица?
$ oid2name -d alvherre -f 155156
From database "alvherre":
  Filenode  Table Name
----------------------
    155156         foo</PRE
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN126294"
></A
><H2
>Автор</H2
><P
>Б. Палмер <CODE
CLASS="EMAIL"
>&#60;<A
HREF="mailto:bpalmer@crimelabs.net"
>bpalmer@crimelabs.net</A
>&#62;</CODE
></P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="contrib-prog-client.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Начало</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="pgbench.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Клиентские приложения</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="contrib-prog-client.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><SPAN
CLASS="APPLICATION"
>pgbench</SPAN
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>