<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Изменение параметров</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="Документация по PostgreSQL 9.4.1"
HREF="index.html"><LINK
REL="UP"
TITLE="Настройка сервера"
HREF="runtime-config.html"><LINK
REL="PREVIOUS"
TITLE="Настройка сервера"
HREF="runtime-config.html"><LINK
REL="NEXT"
TITLE="Расположения файлов"
HREF="runtime-config-file-locations.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=UTF-8"><META
NAME="creation"
CONTENT="2016-04-12T07:56:57"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>Документация по PostgreSQL 9.4.1</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Настройка сервера"
HREF="runtime-config.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="runtime-config.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Глава 18. Настройка сервера</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Расположения файлов"
HREF="runtime-config-file-locations.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="CONFIG-SETTING"
>18.1. Изменение параметров</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-SETTING-NAMES-VALUES"
>18.1.1. Имена и значения параметров</A
></H2
><P
>Имена всех параметров являются регистронезависимыми. Каждый параметр принимает значение одного из пяти типов: логический, строка, целое, число с плавающей точкой или перечисление. От типа значения зависит синтаксис установки этого параметра:</P
><P
></P
><UL
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Логический:</I
></SPAN
> Значения могут задаваться строками <TT
CLASS="LITERAL"
>on</TT
>, <TT
CLASS="LITERAL"
>off</TT
>, <TT
CLASS="LITERAL"
>true</TT
>, <TT
CLASS="LITERAL"
>false</TT
>, <TT
CLASS="LITERAL"
>yes</TT
>, <TT
CLASS="LITERAL"
>no</TT
>, <TT
CLASS="LITERAL"
>1</TT
>, <TT
CLASS="LITERAL"
>0</TT
> (регистр не имеет значения), либо как достаточно однозначный префикс одной из этих строк.</P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Строка:</I
></SPAN
> Обычно строковое значение заключается в апострофы (при этом внутренние апострофы дублируются). Однако, если значение является простым числом или идентификатором, апострофы обычно можно опустить.</P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Число (целое или с плавающей точкой):</I
></SPAN
> Десятичная точка как разделитель целой и дробной части допускается только для параметров, принимающих числа с плавающей точкой. Разделители разрядов в записи числа не принимаются. Заключать в апострофы число не требуется.</P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Число с единицей измерения:</I
></SPAN
> Некоторые числовые параметры задаются с единицами измерения, так как они описывают количества информации или времени. Единицами могут быть килобайты, блоки (обычно восемь килобайт), миллисекунды, секунды или минуты. При указании только числового значения для такого параметра единицей измерения будет считаться единица по умолчанию для параметра, которая указывается в <TT
CLASS="STRUCTNAME"
>pg_settings</TT
>.<TT
CLASS="STRUCTFIELD"
>unit</TT
>. Для удобства параметры также можно задавать, указывая единицу измерения явно, например, задать <TT
CLASS="LITERAL"
>'120 ms'</TT
> для значения времени, при этом такое значение будет переведено в основную единицу измерения параметра. Заметьте, что для этого значение должно записываться в виде строки (в апострофах). Имя единицы является регистронезависимым, а между ним и числом допускаются пробельные символы. <P
></P
></P><UL
><LI
><P
>Допустимые единицы информации: <TT
CLASS="LITERAL"
>kB</TT
> (килобайты), <TT
CLASS="LITERAL"
>MB</TT
> (мегабайты), <TT
CLASS="LITERAL"
>GB</TT
> (гигабайты) и <TT
CLASS="LITERAL"
>TB</TT
> (терабайты). Множителем единиц информации считается 1024, не 1000.</P
></LI
><LI
><P
>Допустимые единицы времени: <TT
CLASS="LITERAL"
>ms</TT
> (миллисекунды), <TT
CLASS="LITERAL"
>s</TT
> (секунды), <TT
CLASS="LITERAL"
>min</TT
> (минуты), <TT
CLASS="LITERAL"
>h</TT
> (часы) и <TT
CLASS="LITERAL"
>d</TT
> (дни).</P
></LI
></UL
><P></P
></LI
><LI
><P
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Перечисление:</I
></SPAN
> Параметры, имеющие тип перечисление, записываются так же, как строковые параметры, но могут иметь только ограниченный набор значений. Список допустимых значений такого параметра задаётся в <TT
CLASS="STRUCTNAME"
>pg_settings</TT
>.<TT
CLASS="STRUCTFIELD"
>enumvals</TT
>. В значениях перечислений регистр не учитывается.</P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-SETTING-CONFIGURATION-FILE"
>18.1.2. Определение параметров в файле конфигурации</A
></H2
><P
>Самый основной способ установки этих параметров — определение их значений в файле <TT
CLASS="FILENAME"
>postgresql.conf</TT
>, который обычно находится в каталоге данных. При инициализации каталога кластера БД в этот каталог помещается копия стандартного файла. Например, он может выглядеть так: </P><PRE
CLASS="PROGRAMLISTING"
># Это комментарий
log_connections = yes
log_destination = 'syslog'
search_path = '"$user", public'
shared_buffers = 128MB</PRE
><P> Каждый параметр определяется в отдельной строке. Знак равенства в ней между именем и значением является необязательным. Пробельные символы в строке не играют роли (кроме значений, заключённых в апострофы), а пустые строки игнорируются. Знаки решётки (<TT
CLASS="LITERAL"
>#</TT
>) обозначают продолжение строки как комментарий. Значения параметров, не являющиеся простыми идентификаторами или числами, должны заключаться в апострофы. Чтобы включить в такое значение собственно апостроф, его следует продублировать (предпочтительнее) или предварить обратной косой чертой.</P
><P
>Параметры, установленные таким образом, задают значения по умолчанию для данного кластера. Эти значения будут действовать в активных сеансах, если не будут переопределены. В следующих разделах описывается, как их может переопределить администратор или пользователь.</P
><P
> Основной процесс сервера перечитывает файл конфигурации заново, получая сигнал <SPAN
CLASS="SYSTEMITEM"
>SIGHUP</SPAN
>; послать его проще всего можно, запустив <TT
CLASS="LITERAL"
>pg_ctl reload</TT
> в командной строке или вызвав SQL-функцию <CODE
CLASS="FUNCTION"
>pg_reload_conf()</CODE
>. Основной процесс сервера передаёт этот сигнал всем остальным запущенным серверным процессам, так что существующие сеансы тоже получают новые значения (после того, как завершится выполнение текущей команды клиента). Также возможно послать этот сигнал напрямую одному из серверных процессов. Учтите, что некоторые параметры можно установить только при запуске сервера; любые изменения их значений в файле конфигурации не будут учитываться до перезапуска сервера. Более того, при обработке <SPAN
CLASS="SYSTEMITEM"
>SIGHUP</SPAN
> игнорируются неверные значения параметров (но об этом сообщается в журнале).</P
><P
>В дополнение к <TT
CLASS="FILENAME"
>postgresql.conf</TT
> в каталоге данных <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> содержится файл <TT
CLASS="FILENAME"
>postgresql.auto.conf</TT
>, который имеет тот же формат, что и <TT
CLASS="FILENAME"
>postgresql.conf</TT
>, но не должен редактироваться вручную. Этот файл содержит параметры, задаваемые командой <A
HREF="sql-altersystem.html"
>ALTER SYSTEM</A
>. Он считывается автоматически одновременно с <TT
CLASS="FILENAME"
>postgresql.conf</TT
> и заданные в нём параметры действуют таким же образом. Параметры в <TT
CLASS="FILENAME"
>postgresql.auto.conf</TT
> переопределяют те, что указаны в <TT
CLASS="FILENAME"
>postgresql.conf</TT
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-SETTING-SQL-COMMAND-INTERACTION"
>18.1.3. Управление параметрами через SQL</A
></H2
><P
>В <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> есть три SQL-команды, задающие для параметров значения по умолчанию. Уже упомянутая команда <A
HREF="sql-altersystem.html"
>ALTER SYSTEM</A
> даёт возможность изменять глобальные значения средствами SQL; она функционально равнозначна редактированию <TT
CLASS="FILENAME"
>postgresql.conf</TT
>. Кроме того, есть ещё две команды, которые позволяют задавать значения по умолчанию на уровне баз данных и ролей:</P
><P
></P
><UL
><LI
><P
>Команда <A
HREF="sql-alterdatabase.html"
>ALTER DATABASE</A
> позволяет переопределить глобальные параметры на уровне базы данных.</P
></LI
><LI
><P
>Команда <A
HREF="sql-alterrole.html"
>ALTER ROLE</A
> позволяет переопределить для конкретного пользователя как глобальные, так и локальные для базы данных параметры.</P
></LI
></UL
><P
>Значения, установленные командами <TT
CLASS="COMMAND"
>ALTER DATABASE</TT
> и <TT
CLASS="COMMAND"
>ALTER ROLE</TT
>, применяются только при новом подключении к базе данных. Они переопределяют значения, полученные из файлов конфигурации или командной строки сервера, и применяются по умолчанию в рамках сеанса. Заметьте, что некоторые параметры невозможно изменить после запуска сервера, поэтому их нельзя установить этими командами (или командами, перечисленными ниже).</P
><P
>Когда клиент подключён к базе данных, он может воспользоваться двумя дополнительными командами SQL (и равнозначными функциями), которые предоставляет <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> для управления параметрами конфигурации:</P
><P
></P
><UL
><LI
><P
>Команда <A
HREF="sql-show.html"
>SHOW</A
> позволяет узнать текущее значение всех параметров. Соответствующая ей функция — <CODE
CLASS="FUNCTION"
>current_setting(имя_параметра text)</CODE
>.</P
></LI
><LI
><P
>Команда <A
HREF="sql-set.html"
>SET</A
> позволяет изменить текущее значение параметров, которые действуют локально в рамках сеанса; на другие сеансы она не влияет. Соответствующая ей функция — <CODE
CLASS="FUNCTION"
>set_config(имя_параметра, новое_значение, локально)</CODE
>.</P
></LI
></UL
><P
>Кроме того, просмотреть и изменить значения параметров для текущего сеанса можно в системном представлении <A
HREF="view-pg-settings.html"
><TT
CLASS="STRUCTNAME"
>pg_settings</TT
></A
>:</P
><P
></P
><UL
><LI
><P
>Запрос на чтение представления выдаёт ту же информацию, что и <TT
CLASS="COMMAND"
>SHOW ALL</TT
>, но более подробно. Этот подход и более гибкий, так как в нём можно указать условия фильтра или связать результат с другими отношениями.</P
></LI
><LI
><P
>Выполнение <A
HREF="sql-update.html"
>UPDATE</A
> для этого представления, а именно присвоение значения колонке, равносильно выполнению команды <TT
CLASS="COMMAND"
>SET</TT
>. Например, команде </P><PRE
CLASS="PROGRAMLISTING"
>SET configuration_parameter TO DEFAULT;</PRE
><P> равнозначен запрос: </P><PRE
CLASS="PROGRAMLISTING"
>UPDATE pg_settings SET setting = reset_val WHERE name = 'configuration_parameter';</PRE
><P></P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN29425"
>18.1.4. Управление параметрами в командной строке</A
></H2
><P
>Помимо изменения глобальных значений по умолчанию и переопределения их на уровне базы данных или роли, параметры <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> можно изменить, используя средства командной строки. Управление через командную строку поддерживают и сервер, и клиентская библиотека <SPAN
CLASS="APPLICATION"
>libpq</SPAN
>.</P
><P
></P
><UL
><LI
><P
>При запуске сервера, значения параметров можно передать команде <TT
CLASS="COMMAND"
>postgres</TT
> в аргументе командной строки <TT
CLASS="OPTION"
>-c</TT
>. Например: </P><PRE
CLASS="PROGRAMLISTING"
>postgres -c log_connections=yes -c log_destination='syslog'</PRE
><P> Параметры, заданные таким образом, переопределяют те, что были установлены в <TT
CLASS="FILENAME"
>postgresql.conf</TT
> или командой <TT
CLASS="COMMAND"
>ALTER SYSTEM</TT
>, так что их нельзя изменить глобально без перезапуска сервера.</P
></LI
><LI
><P
>При запуске клиентского сеанса, использующего <SPAN
CLASS="APPLICATION"
>libpq</SPAN
>, значения параметров можно указать в переменной окружения <TT
CLASS="ENVAR"
>PGOPTIONS</TT
>. Заданные таким образом параметры будут определять значения по умолчанию на время сеанса, но никак не влияют на другие сеансы. По историческим причинам формат <TT
CLASS="ENVAR"
>PGOPTIONS</TT
> похож на тот, что применяется при запуске команды <TT
CLASS="COMMAND"
>postgres</TT
>; в частности, в нём должен присутствовать флаг <TT
CLASS="OPTION"
>-c</TT
>. Например: </P><PRE
CLASS="PROGRAMLISTING"
>env PGOPTIONS="-c geqo=off -c statement_timeout=5min" psql</PRE
><P></P
><P
>Другие клиенты и библиотеки могут иметь собственные механизмы управления параметрами, через командную строку или как-то иначе, используя которые пользователь сможет менять параметры сеанса, не выполняя непосредственно команды SQL.</P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-INCLUDES"
>18.1.5. Упорядочение содержимого файлов конфигурации</A
></H2
><P
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> предоставляет несколько возможностей для разделения сложных файлов <TT
CLASS="FILENAME"
>postgresql.conf</TT
> на вложенные файлы. Эти возможности особенно полезны при управлении множеством серверов с похожими, но не одинаковыми конфигурациями.</P
><P
> Помимо присвоений значений параметров, <TT
CLASS="FILENAME"
>postgresql.conf</TT
> может содержать <I
CLASS="FIRSTTERM"
>директивы включения</I
> файлов, которые будут прочитаны и обработаны, как если бы их содержимое было вставлено в данном месте файла конфигурации. Это позволяет разбивать файл конфигурации на физически отдельные части. Директивы включения записываются просто: </P><PRE
CLASS="PROGRAMLISTING"
>include 'имя_файла'</PRE
><P> Если имя файла задаётся не абсолютным путём, оно рассматривается относительно каталога, в котором находится включающий файл конфигурации. Включения файлов могут быть вложенными.</P
><P
> Кроме того, есть директива <TT
CLASS="LITERAL"
>include_if_exists</TT
>, которая работает подобно <TT
CLASS="LITERAL"
>include</TT
>, за исключением случаев, когда включаемый файл не существует или не может быть прочитан. Обычная директива <TT
CLASS="LITERAL"
>include</TT
> считает это критической ошибкой, но <TT
CLASS="LITERAL"
>include_if_exists</TT
> просто выводит сообщение и продолжает обрабатывать текущий файл конфигурации.</P
><P
> Файл <TT
CLASS="FILENAME"
>postgresql.conf</TT
> может также содержать директивы <TT
CLASS="LITERAL"
>include_dir</TT
>, позволяющие подключать целые каталоги с файлами конфигурации. Они записываются так: </P><PRE
CLASS="PROGRAMLISTING"
>include_dir 'каталог'</PRE
><P> Имена, заданные не абсолютным путём, рассматриваются относительно каталога, содержащего текущий файл конфигурации. В заданном каталоге включению подлежат только файлы с именами, оканчивающимися на <TT
CLASS="LITERAL"
>.conf</TT
>. При этом файлы с именами, начинающимися с &laquo;<TT
CLASS="LITERAL"
>.</TT
>&raquo;, тоже игнорируются, для предотвращения ошибок, так как они считаются скрытыми в ряде систем. Набор файлов во включаемом каталоге обрабатывается по порядку имён (определяемому правилами, принятыми в C, т. е. цифры идут перед буквами, а буквы в верхнем регистре — перед буквами в нижнем).</P
><P
>Включение файлов или каталогов позволяет разделить конфигурацию базы данных на логические части, а не вести один большой файл <TT
CLASS="FILENAME"
>postgresql.conf</TT
>. Например, представьте, что в некоторой компании есть два сервера баз данных, с разным объёмом ОЗУ. Скорее всего при этом их конфигурации будут иметь общие элементы, например, параметры ведения журналов. Но параметры, связанные с памятью, у них будут различаться. Кроме того, другие параметры могут быть специфическими для каждого сервера. Один из вариантов эффективного управления такими конфигурациями — разделить изменения стандартной конфигурации на три файла. Чтобы подключить эти файлы, можно добавить в конец файла <TT
CLASS="FILENAME"
>postgresql.conf</TT
> следующие директивы: </P><PRE
CLASS="PROGRAMLISTING"
>include 'shared.conf'
include 'memory.conf'
include 'server.conf'</PRE
><P> Общие для всех серверов параметры будут помещаться в <TT
CLASS="FILENAME"
>shared.conf</TT
>. Файл <TT
CLASS="FILENAME"
>memory.conf</TT
> может иметь два варианта — первый для серверов с 8ГБ ОЗУ, а второй для серверов с 16 ГБ. Наконец, <TT
CLASS="FILENAME"
>server.conf</TT
> может содержать действительно специфические параметры для каждого отдельного сервера.</P
><P
>Также возможно создать каталог с файлами конфигурации и поместить туда все эти файлы. Например, так можно подключить каталог <TT
CLASS="FILENAME"
>conf.d</TT
> в конце <TT
CLASS="FILENAME"
>postgresql.conf</TT
>: </P><PRE
CLASS="PROGRAMLISTING"
>include_dir 'conf.d'</PRE
><P> Затем можно дать файлам в каталоге <TT
CLASS="FILENAME"
>conf.d</TT
> следующие имена: </P><PRE
CLASS="PROGRAMLISTING"
>00shared.conf
01memory.conf
02server.conf</PRE
><P> Такое именование устанавливает чёткий порядок подключения этих файлов, что важно, так как если параметр определяется несколько раз в разных файлах конфигурации, действовать будет последнее определение. В рамках данного примера, установленное в <TT
CLASS="FILENAME"
>conf.d/02server.conf</TT
> значение переопределит значение того же параметра, заданное в <TT
CLASS="FILENAME"
>conf.d/01memory.conf</TT
>.</P
><P
>Вы можете применить этот подход и с описательными именами файлов: </P><PRE
CLASS="PROGRAMLISTING"
>00shared.conf
01memory-8GB.conf
02server-foo.conf</PRE
><P> При таком упорядочивании каждому варианту файла конфигурации даётся уникальное имя. Это помогает исключить конфликты, если конфигурации разных серверов нужно хранить в одном месте, например, в репозитории системы управления версиями. (Кстати, хранение файлов конфигурации в системе управления версиями — это ещё один эффективный приём, который стоит применять.)</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="runtime-config.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Начало</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="runtime-config-file-locations.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Настройка сервера</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="runtime-config.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Расположения файлов</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>