<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Поддержка языковых стандартов</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="Документация по PostgreSQL 9.4.1"
HREF="index.html"><LINK
REL="UP"
TITLE="Локализация"
HREF="charset.html"><LINK
REL="PREVIOUS"
TITLE="Локализация"
HREF="charset.html"><LINK
REL="NEXT"
TITLE="Поддержка правил сортировки"
HREF="collation.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=UTF-8"><META
NAME="creation"
CONTENT="2016-04-12T07:56:57"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>Документация по PostgreSQL 9.4.1</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Локализация"
HREF="charset.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="charset.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Глава 22. Локализация</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Поддержка правил сортировки"
HREF="collation.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="LOCALE"
>22.1. Поддержка языковых стандартов</A
></H1
><P
>Поддержка <I
CLASS="FIRSTTERM"
>языковых стандартов</I
> в приложениях относится к культурным предпочтениям, которые касаются алфавита, порядка сортировки, форматирования чисел и т. п. <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> использует соответствующие стандартам ISO C и <ACRONYM
CLASS="ACRONYM"
>POSIX</ACRONYM
> возможности локали, предоставляемые операционной системой сервера. За дополнительной информацией обращайтесь к документации вашей системы.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN34947"
>22.1.1. Обзор</A
></H2
><P
>Поддержка локали автоматически инициализируется, когда кластер базы данных создаётся при помощи <TT
CLASS="COMMAND"
>initdb</TT
>. <TT
CLASS="COMMAND"
>initdb</TT
> инициализирует кластер баз данных по умолчанию с локалью из окружения выполнения. Поэтому, если ваша система уже использует локаль, которую вы хотите выбрать для вашего кластера баз данных, вам не требуется дополнительно совершать никаких действий. Если вы хотите использовать другую локаль (или вы точно не знаете, какая локаль используется в вашей системе), вы можете указать для <TT
CLASS="COMMAND"
>initdb</TT
> какую именно локаль использовать через задание параметра <TT
CLASS="OPTION"
>--locale</TT
>. Например: </P><PRE
CLASS="SCREEN"
>initdb --locale=ru_RU</PRE
><P></P
><P
>Данный пример для Unix-систем задаёт русский язык (<TT
CLASS="LITERAL"
>ru</TT
>), на котором говорят в России (<TT
CLASS="LITERAL"
>RU</TT
>). Другими вариантами могут быть <TT
CLASS="LITERAL"
>en_US</TT
> (американский английский) и <TT
CLASS="LITERAL"
>fr_CA</TT
> (канадский французский). Если в языковом окружении может использоваться более одного набора символов, значение может принимать вид <TT
CLASS="REPLACEABLE"
><I
>language_territory.codeset</I
></TT
>. Например, <TT
CLASS="LITERAL"
>fr_BE.UTF-8</TT
> обозначает французский язык (fr), на котором говорят в Бельгии (BE), с кодировкой <ACRONYM
CLASS="ACRONYM"
>UTF-8</ACRONYM
>.</P
><P
>То, какие локали и под какими именами доступны на вашей системе, зависит от того, что было включено в операционную систему производителем и что из этого было установлено. В большинстве Unix-систем команда <TT
CLASS="LITERAL"
>locale -a</TT
> выведет список доступных локалей. Windows использует более развёрнутые имена локалей, такие как <TT
CLASS="LITERAL"
>German_Germany</TT
> или <TT
CLASS="LITERAL"
>Russian_Russia.1251</TT
>, но принципы остаются теми же.</P
><P
>Иногда целесообразно объединить правила из различных локалей, например, использовать английские правила сравнения и испанские сообщения. Для этой цели существует набор категорий локали, каждая из которых управляет только определёнными аспектами правил локализации: <DIV
CLASS="INFORMALTABLE"
><P
></P
><A
NAME="AEN34968"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><TBODY
><TR
><TD
><TT
CLASS="ENVAR"
>LC_COLLATE</TT
></TD
><TD
>Порядок сортировки строк</TD
></TR
><TR
><TD
><TT
CLASS="ENVAR"
>LC_CTYPE</TT
></TD
><TD
>Классификация символов (Что представляет собой буква? Каков её эквивалент в верхнем регистре?)</TD
></TR
><TR
><TD
><TT
CLASS="ENVAR"
>LC_MESSAGES</TT
></TD
><TD
>Язык сообщений</TD
></TR
><TR
><TD
><TT
CLASS="ENVAR"
>LC_MONETARY</TT
></TD
><TD
>Форматирование валютных сумм</TD
></TR
><TR
><TD
><TT
CLASS="ENVAR"
>LC_NUMERIC</TT
></TD
><TD
>Форматирование чисел</TD
></TR
><TR
><TD
><TT
CLASS="ENVAR"
>LC_TIME</TT
></TD
><TD
>Форматирование даты и времени</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
> Эти имена категорий <TT
CLASS="COMMAND"
>initdb</TT
> принимает в качестве имён соответствующих параметров, позволяющих переопределить выбор локали в определённой категории. Например, чтобы настроить локаль на канадский французский, но при этом использовать американские правила форматирования денежных сумм, используйте <TT
CLASS="LITERAL"
>initdb --locale=fr_CA --lc-monetary=en_US</TT
>.</P
><P
>Если вы хотите, чтобы система работала без языковой поддержки, используйте специальное имя локали <TT
CLASS="LITERAL"
>C</TT
> либо эквивалентное ему <TT
CLASS="LITERAL"
>POSIX</TT
>.</P
><P
>Значения некоторых категорий локали должны быть заданы при создании базы данных. Вы можете использовать различные параметры локали для различных баз данных, но после создания базы вы уже не сможете изменить их для этой базы данных. <TT
CLASS="LITERAL"
>LC_COLLATE</TT
> и <TT
CLASS="LITERAL"
>LC_CTYPE</TT
> являются этими категориями. Они влияют на порядок сортировки в индексах, поэтому они должны быть зафиксированы, иначе индексы на текстовых столбцах могут повредиться. (Однако, можно смягчить эти ограничения через задание правил сравнения, как это описано в разделе <A
HREF="collation.html"
>Раздел 22.2</A
>.) Значения по умолчанию для этих категорий определяются при запуске <TT
CLASS="COMMAND"
>initdb</TT
>, и эти значения используются при создании новых баз данных, если другие значения не указаны явно в команде <TT
CLASS="COMMAND"
>CREATE DATABASE</TT
>.</P
><P
>Прочие категории локали вы можете изменить в любое время, настроив параметры конфигурации сервера, которые имеют такое же имя как и категории локали (подробнее см. <A
HREF="runtime-config-client.html#RUNTIME-CONFIG-CLIENT-FORMAT"
>Подраздел 18.11.2</A
>). Значения, выбранные через <TT
CLASS="COMMAND"
>initdb</TT
>, фактически записываются лишь в файл конфигурации <TT
CLASS="FILENAME"
>postgresql.conf</TT
>, чтобы использоваться по умолчанию при запуске сервера. Если вы удалите эти значения из <TT
CLASS="FILENAME"
>postgresql.conf</TT
>, сервер получит соответствующие значения из своей среды выполнения.</P
><P
>Обратите внимание на то, что поведение локали сервера определяется переменными среды, установленными на стороне сервера, а не средой клиента. Таким образом, необходимо правильно сконфигурировать локаль перед запуском сервера. Если же клиент и сервер работают с разными локалями, то сообщения, возможно, будут появляться на разных языках в зависимости от того, где они возникают.</P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Замечание: </B
>Когда мы говорим о наследовании локали от среды выполнения, это означает следующее для большинства операционных систем: для определённой категории локали, к примеру, для правил сортировки, следующие переменные среды анализируются в приведённом ниже порядке до тех пор, пока одна из них не окажется заданной: <TT
CLASS="ENVAR"
>LC_ALL</TT
>, <TT
CLASS="ENVAR"
>LC_COLLATE</TT
> (или переменная, относящаяся к соответствующей категории), <TT
CLASS="ENVAR"
>LANG</TT
>. Если ни одна их этих переменных среды не задана, значение локали устанавливается по умолчанию в <TT
CLASS="LITERAL"
>C</TT
>.</P
><P
>Некоторые библиотеки локализации сообщений также обращаются к переменной среды <TT
CLASS="ENVAR"
>LANGUAGE</TT
>, которая заменяет все прочие параметры локализации при выборе языка сообщений. В случае затруднений, пожалуйста, воспользуйтесь документацией по вашей операционной системе, в частности, справкой по <SPAN
CLASS="APPLICATION"
>gettext</SPAN
>.</P
></BLOCKQUOTE
></DIV
><P
>Для того чтобы стал возможен перевод сообщений на язык, выбранный пользователем, <ACRONYM
CLASS="ACRONYM"
>NLS</ACRONYM
> должен быть выбран на момент сборки (<TT
CLASS="LITERAL"
>configure --enable-nls</TT
>). В остальном поддержка локализации осуществляется автоматически.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN35024"
>22.1.2. Поведение</A
></H2
><P
>Локаль влияет на следующий функционал SQL: <P
></P
></P><UL
><LI
><P
>Порядок сортировки в запросах с использованием <TT
CLASS="LITERAL"
>ORDER BY</TT
> или стандартных операторах сравнения текстовых данных </P
></LI
><LI
><P
><CODE
CLASS="FUNCTION"
>upper</CODE
>, <CODE
CLASS="FUNCTION"
>lower</CODE
>, и <CODE
CLASS="FUNCTION"
>initcap</CODE
> функции </P
></LI
><LI
><P
>Операторы  поиска по шаблону (<TT
CLASS="LITERAL"
>LIKE</TT
>, <TT
CLASS="LITERAL"
>SIMILAR TO</TT
>, и регулярные выражения в стиле POSIX); локаль влияет как на поиск без учёта регистра, так и на классификацию знаков по классам символов регулярных выражений </P
></LI
><LI
><P
>семейство функций <CODE
CLASS="FUNCTION"
>to_char</CODE
></P
></LI
><LI
><P
>Возможность использовать индексы с предложениями <TT
CLASS="LITERAL"
>LIKE</TT
></P
></LI
></UL
><P></P
><P
>Недостатком использования отличающихся от <TT
CLASS="LITERAL"
>C</TT
> или <TT
CLASS="LITERAL"
>POSIX</TT
> локалей в <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> является влияние на производительность. Это замедляет обработку символов и мешает <TT
CLASS="LITERAL"
>LIKE</TT
> использовать обычные индексы. По этой причине используйте локали только в том случае, если они действительно вам нужны.</P
><P
>В качестве обходного решения, которое позволит <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> пользоваться индексами с предложениями <TT
CLASS="LITERAL"
>LIKE</TT
> с использованием локали, отличной от С, существует несколько классов пользовательских операторов. Они позволяют создать индекс, который выполняет строгое посимвольное сравнение, игнорируя правила сравнения, соответствующие локали. За дополнительными сведениями обратитесь к <A
HREF="indexes-opclass.html"
>Разделу 11.9</A
>. Ещё один подход заключается в создании индексов с помощью правил сортировки <TT
CLASS="LITERAL"
>C</TT
>, как было сказано в <A
HREF="collation.html"
>Разделе 22.2</A
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN35075"
>22.1.3. Проблемы</A
></H2
><P
>Если поддержка локализации не работает в соответствии с объяснением, данным выше, проверьте, насколько корректна конфигурация поддержки локализации в вашей операционной системе. Чтобы проверить, какие локали установлены на вашей системе, вы можете использовать команду <TT
CLASS="LITERAL"
>locale -a</TT
>, если ваша операционная система поддерживает это.</P
><P
>Проверьте, действительно ли <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> использует локаль, которую вы подразумеваете. Параметры <TT
CLASS="ENVAR"
>LC_COLLATE</TT
> и <TT
CLASS="ENVAR"
>LC_CTYPE</TT
> определяются при создании базы данных, и не могут быть изменены, за исключением случаев, когда создаётся новая база данных. Прочие параметры локали, включая <TT
CLASS="ENVAR"
>LC_MESSAGES</TT
> и <TT
CLASS="ENVAR"
>LC_MONETARY</TT
> первоначально определены средой, в которой запускается сервер, но могут быть оперативно изменены. Вы можете проверить текущие параметры локали с помощью команды <TT
CLASS="COMMAND"
>SHOW</TT
>.</P
><P
>Каталог <TT
CLASS="FILENAME"
>src/test/locale</TT
> в комплекте файлов исходного кода содержит набор тестов для поддержки локализации <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>.</P
><P
>Клиентские приложения, которые обрабатывают ошибки сервера, разбирая текст сообщения об ошибке, очевидно, столкнутся с проблемами, когда сообщения сервера будут на другом языке. Авторам таких приложений рекомендуется пользоваться системой кодов ошибок в качестве альтернативы.</P
><P
>Для поддержки наборов переводов сообщений требуется постоянная работа большого числа волонтёров, которые хотят, чтобы в <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> правильно использовался предпочитаемый ими язык. Если в настоящее время сообщения на вашем языке недоступны или переведены не полностью, будем благодарны вам за содействие. Если вы хотите помочь, обратитесь к <A
HREF="nls.html"
>Главе 51</A
> или напишите на адрес рассылки разработчиков.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="charset.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Начало</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="collation.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Локализация</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="charset.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Поддержка правил сортировки</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>