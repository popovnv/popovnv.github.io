<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>              pgbench
            </TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="Документация по PostgreSQL 9.4.1"
HREF="index.html"><LINK
REL="UP"
TITLE="Клиентские приложения"
HREF="contrib-prog-client.html"><LINK
REL="PREVIOUS"
TITLE="oid2name"
HREF="oid2name.html"><LINK
REL="NEXT"
TITLE="              vacuumlo
            "
HREF="vacuumlo.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=UTF-8"><META
NAME="creation"
CONTENT="2016-04-12T07:56:57"></HEAD
><BODY
CLASS="REFENTRY"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>Документация по PostgreSQL 9.4.1</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="oid2name"
HREF="oid2name.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="contrib-prog-client.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="              vacuumlo
            "
HREF="vacuumlo.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="PGBENCH"
></A
><SPAN
CLASS="APPLICATION"
>pgbench</SPAN
></H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN126306"
></A
><H2
>Название</H2
>pgbench&nbsp;--&nbsp;запустить тест производительности <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
></DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN126310"
></A
><H2
>Синтаксис</H2
><P
><TT
CLASS="COMMAND"
>pgbench</TT
>                  <TT
CLASS="OPTION"
>-i</TT
>
                [                <TT
CLASS="REPLACEABLE"
><I
>параметр</I
></TT
>
              ...] [                <TT
CLASS="REPLACEABLE"
><I
>база_данных</I
></TT
>
              ]</P
><P
><TT
CLASS="COMMAND"
>pgbench</TT
> [                <TT
CLASS="REPLACEABLE"
><I
>параметр</I
></TT
>
              ...] [                <TT
CLASS="REPLACEABLE"
><I
>база_данных</I
></TT
>
              ]</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN126325"
></A
><H2
>Описание</H2
><P
><SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> — это простая программа для запуска тестов производительности <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>. Она многократно выполняет одну последовательность команд, возможно в параллельных сеансах базы данных, а затем вычисляет среднюю скорость транзакций (число транзакций в секунду). По умолчанию <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> тестирует сценарий, примерно соответствующий TPC-B, который состоит из пяти команд <TT
CLASS="COMMAND"
>SELECT</TT
>, <TT
CLASS="COMMAND"
>UPDATE</TT
> и <TT
CLASS="COMMAND"
>INSERT</TT
> в одной транзакции. Однако вы можете легко протестировать и другие сценарии, написав собственные скрипты транзакций.</P
><P
>Типичный вывод pgbench выглядит так: </P><PRE
CLASS="SCREEN"
>transaction type: TPC-B (sort of)
scaling factor: 10
query mode: simple
number of clients: 10
number of threads: 1
number of transactions per client: 1000
number of transactions actually processed: 10000/10000
tps = 85.184871 (including connections establishing)
tps = 85.296346 (excluding connections establishing)</PRE
><P> В первых шести строках выводятся значения некоторых самых важных параметров. В следующей строке показывается количество выполненных и запланированных транзакций (это будет произведение числа клиентов и числа транзакций для одного клиента); эти количества будут равны, если только выполнение не завершится досрочно. (В режиме <TT
CLASS="OPTION"
>-T</TT
> выводится только число фактически выполненных транзакций.) В двух последних строках выводится число транзакций в секунду, вычисленное с учётом и без учёта времени запуска сеансов базы данных.</P
><P
>Для запускаемого по умолчанию теста типа TPC-B требуется предварительно подготовить определённые таблицы. Чтобы создать и наполнить эти таблицы, следует запустить <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> с ключом <TT
CLASS="OPTION"
>-i</TT
> (инициализировать). (Если вы применяете нестандартный скрипт, это не требуется, но тем не менее нужно подготовить конфигурацию, нужную вашему тесту.) Запуск инициализации выглядит так: </P><PRE
CLASS="PROGRAMLISTING"
>pgbench -i [<SPAN
CLASS="OPTIONAL"
> <TT
CLASS="REPLACEABLE"
><I
>другие-параметры</I
></TT
> </SPAN
>] <TT
CLASS="REPLACEABLE"
><I
>имя_базы</I
></TT
></PRE
><P> где <TT
CLASS="REPLACEABLE"
><I
>имя_базы</I
></TT
> — имя уже существующей базы, в которой будет проводиться тест. (Чтобы указать, как подключиться к серверу баз данных, вы также можете добавить параметры <TT
CLASS="OPTION"
>-h</TT
>, <TT
CLASS="OPTION"
>-p</TT
> и/или <TT
CLASS="OPTION"
>-U</TT
>.)</P
><DIV
CLASS="CAUTION"
><P
></P
><TABLE
CLASS="CAUTION"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Предостережение</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
><TT
CLASS="LITERAL"
>pgbench -i</TT
> создаёт четыре таблицы <TT
CLASS="STRUCTNAME"
>pgbench_accounts</TT
>, <TT
CLASS="STRUCTNAME"
>pgbench_branches</TT
>, <TT
CLASS="STRUCTNAME"
>pgbench_history</TT
> и <TT
CLASS="STRUCTNAME"
>pgbench_tellers</TT
>, предварительно уничтожая существующие таблицы с этими именами. Если вы вдруг используете эти имена в своей базе данных, обязательно переключитесь на другую базу!</P
></TD
></TR
></TABLE
></DIV
><P
>С <SPAN
CLASS="QUOTE"
>"коэффициентом масштаба"</SPAN
>, по умолчанию равным 1, эти таблицы изначально содержат такое количество строк: </P><PRE
CLASS="SCREEN"
>table                   # of rows
---------------------------------
pgbench_branches        1
pgbench_tellers         10
pgbench_accounts        100000
pgbench_history         0</PRE
><P> Эти числа можно (и в большинства случаев, даже нужно) увеличить, воспользовавшись параметром <TT
CLASS="OPTION"
>-s</TT
> (коэффициент масштаба). При этом также может быть полезен ключ <TT
CLASS="OPTION"
>-F</TT
> (фактор заполнения).</P
><P
>Подготовив требуемую конфигурацию, можно запустить тест производительности командой без <TT
CLASS="OPTION"
>-i</TT
>, то есть: </P><PRE
CLASS="PROGRAMLISTING"
>pgbench [<SPAN
CLASS="OPTIONAL"
> <TT
CLASS="REPLACEABLE"
><I
>параметры</I
></TT
> </SPAN
>] <TT
CLASS="REPLACEABLE"
><I
>имя_базы</I
></TT
></PRE
><P> Практически во всех случаях, чтобы получить полезные результаты, необходимо передать какие-либо дополнительные параметры. Наиболее важные параметры: <TT
CLASS="OPTION"
>-c</TT
> (число клиентов), <TT
CLASS="OPTION"
>-t</TT
> (число транзакций), <TT
CLASS="OPTION"
>-T</TT
> (длительность) и <TT
CLASS="OPTION"
>-f</TT
> (файл со скриптом). Полный список параметров приведён ниже.</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN126370"
></A
><H2
>Параметры</H2
><P
>Следующий список разделён на три подраздела: одни параметры используются при инициализации базы данных, другие при проведении тестирования, а третьи в обоих случаях.</P
><DIV
CLASS="REFSECT2"
><A
NAME="PGBENCH-INIT-OPTIONS"
></A
><H3
>Параметры инициализации</H3
><P
><SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> принимает следующие аргументы командной строки для инициализации: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="OPTION"
>-i</TT
><BR><TT
CLASS="OPTION"
>--initialize</TT
></DT
><DD
><P
>Требуется для вызова режима инициализации.</P
></DD
><DT
><TT
CLASS="OPTION"
>-F</TT
> <TT
CLASS="REPLACEABLE"
><I
>фактор_заполнения</I
></TT
><BR><TT
CLASS="OPTION"
>--fillfactor=</TT
><TT
CLASS="REPLACEABLE"
><I
>фактор_заполнения</I
></TT
></DT
><DD
><P
>Создать таблицы <TT
CLASS="STRUCTNAME"
>pgbench_accounts</TT
>, <TT
CLASS="STRUCTNAME"
>pgbench_tellers</TT
> и <TT
CLASS="STRUCTNAME"
>pgbench_branches</TT
> с заданным фактором заполнения. Значение по умолчанию — 100.</P
></DD
><DT
><TT
CLASS="OPTION"
>-n</TT
><BR><TT
CLASS="OPTION"
>--no-vacuum</TT
></DT
><DD
><P
>Не выполнять очистку после инициализации.</P
></DD
><DT
><TT
CLASS="OPTION"
>-q</TT
><BR><TT
CLASS="OPTION"
>--quiet</TT
></DT
><DD
><P
>Переключить вывод в немногословный режим, когда выводится только одно сообщение о прогрессе в 5 секунд. В режиме по умолчанию одно сообщение выводится на каждые 100000 строк, при этом за секунду обычно выводится довольно много строк (особенно на хорошем оборудовании).</P
></DD
><DT
><TT
CLASS="OPTION"
>-s</TT
> <TT
CLASS="REPLACEABLE"
><I
>коэффициент_масштаба</I
></TT
><BR><TT
CLASS="OPTION"
>--scale=</TT
><TT
CLASS="REPLACEABLE"
><I
>коэффициент_масштаба</I
></TT
></DT
><DD
><P
>Умножить число генерируемых строк на заданный коэффициент. Например, с ключом <TT
CLASS="LITERAL"
>-s 100</TT
> в таблицу <TT
CLASS="STRUCTNAME"
>pgbench_accounts</TT
> будут записаны 10 000 000 строк. Значение по умолчанию — 1. При коэффициенте, равном 20 000 или больше, колонки, содержащие идентификаторы счетов (колонки <TT
CLASS="STRUCTFIELD"
>aid</TT
>), перейдут к большим целым числам (типу <TT
CLASS="TYPE"
>bigint</TT
>), чтобы в них могли уместиться все возможные значения идентификаторов.</P
></DD
><DT
><TT
CLASS="OPTION"
>--foreign-keys</TT
></DT
><DD
><P
>Создать ограничения внешних ключей между стандартными таблицами.</P
></DD
><DT
><TT
CLASS="OPTION"
>--index-tablespace=<TT
CLASS="REPLACEABLE"
><I
>табл_пространство_индексов</I
></TT
></TT
></DT
><DD
><P
>Создать индексы в указанном табличном пространстве, а не в пространстве по умолчанию.</P
></DD
><DT
><TT
CLASS="OPTION"
>--tablespace=<TT
CLASS="REPLACEABLE"
><I
>табличное пространство</I
></TT
></TT
></DT
><DD
><P
>Создать таблицы в указанном табличном пространстве, а не в пространстве по умолчанию.</P
></DD
><DT
><TT
CLASS="OPTION"
>--unlogged-tables</TT
></DT
><DD
><P
>Создать все таблицы как нежурналируемые, а не как постоянные таблицы.</P
></DD
></DL
></DIV
><P></P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="PGBENCH-RUN-OPTIONS"
></A
><H3
>Параметры тестирования производительности</H3
><P
><SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> принимает следующие аргументы командной строки для тестирования производительности: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="OPTION"
>-c</TT
> <TT
CLASS="REPLACEABLE"
><I
>клиенты</I
></TT
><BR><TT
CLASS="OPTION"
>--client=</TT
><TT
CLASS="REPLACEABLE"
><I
>клиенты</I
></TT
></DT
><DD
><P
>Число имитируемых клиентов, то есть число одновременных сеансов базы данных. Значение по умолчанию — 1.</P
></DD
><DT
><TT
CLASS="OPTION"
>-C</TT
><BR><TT
CLASS="OPTION"
>--connect</TT
></DT
><DD
><P
>Устанавливать новое подключение для каждой транзакции вместо одного для каждого клиента. Это полезно для оценивания издержек подключений.</P
></DD
><DT
><TT
CLASS="OPTION"
>-d</TT
><BR><TT
CLASS="OPTION"
>--debug</TT
></DT
><DD
><P
>Выводить отладочные сообщения.</P
></DD
><DT
><TT
CLASS="OPTION"
>-D</TT
> <TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
><TT
CLASS="LITERAL"
>=</TT
><TT
CLASS="REPLACEABLE"
><I
>значение</I
></TT
><BR><TT
CLASS="OPTION"
>--define=</TT
><TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
><TT
CLASS="LITERAL"
>=</TT
><TT
CLASS="REPLACEABLE"
><I
>значение</I
></TT
></DT
><DD
><P
>Определить переменную для пользовательского скрипта (см. ниже). Параметр <TT
CLASS="OPTION"
>-D</TT
> может добавляться неоднократно.</P
></DD
><DT
><TT
CLASS="OPTION"
>-f</TT
> <TT
CLASS="REPLACEABLE"
><I
>имя_файла</I
></TT
><BR><TT
CLASS="OPTION"
>--file=</TT
><TT
CLASS="REPLACEABLE"
><I
>имя_файла</I
></TT
></DT
><DD
><P
>Прочитать скрипт транзакции из файла <TT
CLASS="REPLACEABLE"
><I
>имя_файла</I
></TT
>. Подробности описаны ниже. Параметры <TT
CLASS="OPTION"
>-N</TT
>, <TT
CLASS="OPTION"
>-S</TT
> и <TT
CLASS="OPTION"
>-f</TT
> являются взаимоисключающими.</P
></DD
><DT
><TT
CLASS="OPTION"
>-j</TT
> <TT
CLASS="REPLACEABLE"
><I
>потоки</I
></TT
><BR><TT
CLASS="OPTION"
>--jobs=</TT
><TT
CLASS="REPLACEABLE"
><I
>потоки</I
></TT
></DT
><DD
><P
>Число рабочих потоков в <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
>. Использовать нескольких потоков может быть полезно в многоядерных системах. Число клиентов должно быть кратно числу потоков, так как каждый поток должен управлять одинаковым числом клиентских сеансов. Значение по умолчанию — 1.</P
></DD
><DT
><TT
CLASS="OPTION"
>-l</TT
><BR><TT
CLASS="OPTION"
>--log</TT
></DT
><DD
><P
>Записать время выполнения каждой транзакции в файл протокола. Подробности описаны ниже.</P
></DD
><DT
><TT
CLASS="OPTION"
>-M</TT
> <TT
CLASS="REPLACEABLE"
><I
>режим_запросов</I
></TT
><BR><TT
CLASS="OPTION"
>--protocol=</TT
><TT
CLASS="REPLACEABLE"
><I
>режим_запросов</I
></TT
></DT
><DD
><P
>Протокол, выбираемый для передачи запросов на сервер: <P
></P
></P><UL
><LI
><P
><TT
CLASS="LITERAL"
>simple</TT
>: использовать протокол простых запросов.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>extended</TT
>: использовать протокол расширенных запросов.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>prepared</TT
>: использовать протокол расширенных запросов с подготовленными операторами.</P
></LI
></UL
><P> По умолчанию выбирается протокол простых запросов. (За подробностями обратитесь к <A
HREF="protocol.html"
>Главе 49</A
>.)</P
></DD
><DT
><TT
CLASS="OPTION"
>-n</TT
><BR><TT
CLASS="OPTION"
>--no-vacuum</TT
></DT
><DD
><P
>Не производить очистку таблиц перед запуском теста. Этот параметр <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>необходим</I
></SPAN
>, если вы применяете собственный сценарий, не затрагивающий стандартные таблицы <TT
CLASS="STRUCTNAME"
>pgbench_accounts</TT
>, <TT
CLASS="STRUCTNAME"
>pgbench_branches</TT
>, <TT
CLASS="STRUCTNAME"
>pgbench_history</TT
> и <TT
CLASS="STRUCTNAME"
>pgbench_tellers</TT
>.</P
></DD
><DT
><TT
CLASS="OPTION"
>-N</TT
><BR><TT
CLASS="OPTION"
>--skip-some-updates</TT
></DT
><DD
><P
>Не производить изменений в <TT
CLASS="STRUCTNAME"
>pgbench_tellers</TT
> и <TT
CLASS="STRUCTNAME"
>pgbench_branches</TT
>. При этом не будет соревновательного доступа на запись к этим таблицам, но тестовый сценарий будет ещё дальше от TPC-B.</P
></DD
><DT
><TT
CLASS="OPTION"
>-P</TT
> <TT
CLASS="REPLACEABLE"
><I
>сек</I
></TT
><BR><TT
CLASS="OPTION"
>--progress=</TT
><TT
CLASS="REPLACEABLE"
><I
>сек</I
></TT
></DT
><DD
><P
>Выводить отчёт о прогрессе через заданное число секунд (<TT
CLASS="LITERAL"
>сек</TT
>). Выдаваемый отчёт включает время, прошедшее с момента запуска, скорость (в tps) с момента предыдущего отчёта, а также средннее время ожидания транзакций и стандартное отклонение. В режиме ограничения скорости (<TT
CLASS="OPTION"
>-R</TT
>) время ожидания вычисляется относительно назначенного времени запуска транзакции, а не фактического времени её начала, так что оно включает и среднее время отставания от графика.</P
></DD
><DT
><TT
CLASS="OPTION"
>-r</TT
><BR><TT
CLASS="OPTION"
>--report-latencies</TT
></DT
><DD
><P
>Выводить по завершении тестировании средняя время ожидания операторов (время выполнения с точки зрения клиента) для каждой команды. Подробности описаны ниже.</P
></DD
><DT
><TT
CLASS="OPTION"
>-R</TT
> <TT
CLASS="REPLACEABLE"
><I
>скорость передачи</I
></TT
><BR><TT
CLASS="OPTION"
>--rate=</TT
><TT
CLASS="REPLACEABLE"
><I
>скорость передачи</I
></TT
></DT
><DD
><P
>Выполнять транзакции, ориентируясь на заданную скорость, а не максимально быстро (по умолчанию). Скорость задаётся в транзакциях в секунду. Если заданная скорость превышает максимально возможную, это ограничение скорости не повлияет на результаты.</P
><P
>Для получения нужной скорости транзакции запускаются со случайными задержками, имеющими распределение Пуассона. При этом запланированное время запуска отсчитывается от начального времени, а не от завершения предыдущей транзакции. Это означает, что если какие-то транзакции отстанут от изначально рассчитанного времени завершения, всё же возможно, что последующие нагонят график.</P
><P
>В режиме ограничения скорости время ожидания транзакций, выводимое по итогам тестирования, вычисляется, исходя из запланированного времени запуска, так что в него входит время, которое очередная транзакция должна была ждать завершения предыдущей транзакции. Это время называется временем отклонения от графика, и его среднее и максимальное значение выводятся отдельно. Время ожидания транзакций с момента их фактического запуска, то есть время, потраченное на выполнение транзакций в базе данных, можно получить, если вычесть время отклонения от графика из времени ожидания транзакций.</P
><P
>Большое значение отклонения от графика свидетельствует о том, что система не успевает выполнять транзакции с заданной скоростью и выбранным числом клиентов и потоков. Когда среднее время ожидания транзакции превышает запланированный интервал между транзакциями, каждая последующая транзакция будет отставать от графика и чем дольше будет выполняться тестирование, тем больше будет отставание. Когда это наблюдается, нужно уменьшить скорость транзакций.</P
></DD
><DT
><TT
CLASS="OPTION"
>-s</TT
> <TT
CLASS="REPLACEABLE"
><I
>коэффициент_масштаба</I
></TT
><BR><TT
CLASS="OPTION"
>--scale=</TT
><TT
CLASS="REPLACEABLE"
><I
>коэффициент_масштаба</I
></TT
></DT
><DD
><P
>Показать заданный коэффициент масштаба в выводе <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
>. Для встроенных тестов это не требуется; корректный коэффициент масштаба будет получен в результате подсчёта строк в таблице <TT
CLASS="STRUCTNAME"
>pgbench_branches</TT
>. Однако для нестандартных тестов (запускаемых с ключом <TT
CLASS="OPTION"
>-f</TT
>) без этого параметра в качестве коэффициента масштаба будет выводиться 1.</P
></DD
><DT
><TT
CLASS="OPTION"
>-S</TT
><BR><TT
CLASS="OPTION"
>--select-only</TT
></DT
><DD
><P
>Выполнять транзакции, осуществляющие только выборку, вместо теста типа TPC-B.</P
></DD
><DT
><TT
CLASS="OPTION"
>-t</TT
> <TT
CLASS="REPLACEABLE"
><I
>транзакции</I
></TT
><BR><TT
CLASS="OPTION"
>--transactions=</TT
><TT
CLASS="REPLACEABLE"
><I
>транзакции</I
></TT
></DT
><DD
><P
>Число транзакций, которые будут выполняться каждым клиентом (по умолчанию 10).</P
></DD
><DT
><TT
CLASS="OPTION"
>-T</TT
> <TT
CLASS="REPLACEABLE"
><I
>секунды</I
></TT
><BR><TT
CLASS="OPTION"
>--time=</TT
><TT
CLASS="REPLACEABLE"
><I
>секунды</I
></TT
></DT
><DD
><P
>Выполнять тест с ограничением по времени (в секундах), а не по числу транзакций для каждого клиента. Параметры <TT
CLASS="OPTION"
>-t</TT
> и <TT
CLASS="OPTION"
>-T</TT
> являются взаимоисключающими.</P
></DD
><DT
><TT
CLASS="OPTION"
>-v</TT
><BR><TT
CLASS="OPTION"
>--vacuum-all</TT
></DT
><DD
><P
>Очищать все четыре стандартные таблицы перед запуском теста. Без параметра <TT
CLASS="OPTION"
>-n</TT
> и <TT
CLASS="OPTION"
>-v</TT
> pgbench будет очищать от старых записей таблицы <TT
CLASS="STRUCTNAME"
>pgbench_tellers</TT
> и <TT
CLASS="STRUCTNAME"
>pgbench_branches</TT
>, а также опустошать <TT
CLASS="STRUCTNAME"
>pgbench_history</TT
>.</P
></DD
><DT
><TT
CLASS="OPTION"
>--aggregate-interval=<TT
CLASS="REPLACEABLE"
><I
>секунды</I
></TT
></TT
></DT
><DD
><P
>Интервал агрегации (в секундах). Может использоваться совместно с <SPAN
CLASS="APPLICATION"
>-l</SPAN
> — с данным параметром в протокол будет выводиться итог по интервалу (число транзакций, мин./макс. время ожидания и два дополнительных поля, полезных для оценки отклонений).</P
><P
>В настоящее время этот параметр не поддерживается в Windows.</P
></DD
><DT
><TT
CLASS="OPTION"
>--sampling-rate=<TT
CLASS="REPLACEABLE"
><I
>скорость передачи</I
></TT
></TT
></DT
><DD
><P
>Частота выборки для записи данных в протокол, изменяя которую можно уменьшить объём протокола. При указании этого параметра в протокол выводится информация только о заданном проценте транзакций. Со значением 1.0 в нём будут отмечаться все транзакции, а с 0.05 только 5%.</P
><P
>Обрабатывая протокол, не забудьте учесть частоту выборки. Например, вычисляя скорость (tps), вам нужно будет соответственно умножить содержащиеся в нём числа (то есть, с частотой выборки 0.01 вы получите только 1/100 фактической скорости).</P
></DD
></DL
></DIV
><P></P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="PGBENCH-COMMON-OPTIONS"
></A
><H3
>Общие параметры</H3
><P
><SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> принимает следующие общие аргументы командной строки: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="OPTION"
>-h</TT
> <TT
CLASS="REPLACEABLE"
><I
>компьютер</I
></TT
><BR><TT
CLASS="OPTION"
>--host=</TT
><TT
CLASS="REPLACEABLE"
><I
>компьютер</I
></TT
></DT
><DD
><P
>Адрес сервера баз данных</P
></DD
><DT
><TT
CLASS="OPTION"
>-p</TT
> <TT
CLASS="REPLACEABLE"
><I
>порт</I
></TT
><BR><TT
CLASS="OPTION"
>--port=</TT
><TT
CLASS="REPLACEABLE"
><I
>порт</I
></TT
></DT
><DD
><P
>Номер порта сервера баз данных</P
></DD
><DT
><TT
CLASS="OPTION"
>-U</TT
> <TT
CLASS="REPLACEABLE"
><I
>имя_пользователя</I
></TT
><BR><TT
CLASS="OPTION"
>--username=</TT
><TT
CLASS="REPLACEABLE"
><I
>имя_пользователя</I
></TT
></DT
><DD
><P
>Имя пользователя для подключения</P
></DD
><DT
><TT
CLASS="OPTION"
>-V</TT
><BR><TT
CLASS="OPTION"
>--version</TT
></DT
><DD
><P
>Вывести версию <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> и завершиться.</P
></DD
><DT
><TT
CLASS="OPTION"
>-?</TT
><BR><TT
CLASS="OPTION"
>--help</TT
></DT
><DD
><P
>Вывести справку об аргументах командной строки <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> и завершиться.</P
></DD
></DL
></DIV
><P></P
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN126703"
></A
><H2
>Замечания</H2
><DIV
CLASS="REFSECT2"
><A
NAME="AEN126705"
></A
><H3
>Каково содержание <SPAN
CLASS="QUOTE"
>"транзакции"</SPAN
>, которую выполняет pgbench?</H3
><P
>Стандартный скрипт теста выполняет в транзакции семь команд:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>                    <TT
CLASS="LITERAL"
>BEGIN;</TT
>
                  </P
></LI
><LI
><P
>                    <TT
CLASS="LITERAL"
>UPDATE pgbench_accounts SET abalance = abalance + :delta WHERE aid = :aid;</TT
>
                  </P
></LI
><LI
><P
>                    <TT
CLASS="LITERAL"
>SELECT abalance FROM pgbench_accounts WHERE aid = :aid;</TT
>
                  </P
></LI
><LI
><P
>                    <TT
CLASS="LITERAL"
>UPDATE pgbench_tellers SET tbalance = tbalance + :delta WHERE tid = :tid;</TT
>
                  </P
></LI
><LI
><P
>                    <TT
CLASS="LITERAL"
>UPDATE pgbench_branches SET bbalance = bbalance + :delta WHERE bid = :bid;</TT
>
                  </P
></LI
><LI
><P
>                    <TT
CLASS="LITERAL"
>INSERT INTO pgbench_history (tid, bid, aid, delta, mtime) VALUES (:tid, :bid, :aid, :delta, CURRENT_TIMESTAMP);</TT
>
                  </P
></LI
><LI
><P
>                    <TT
CLASS="LITERAL"
>END;</TT
>
                  </P
></LI
></OL
><P
>С параметром <TT
CLASS="OPTION"
>-N</TT
> шаги 4 и 5 исключаются из транзакции, а с параметром <TT
CLASS="OPTION"
>-S</TT
> будет выполняться только <TT
CLASS="COMMAND"
>SELECT</TT
>.</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN126735"
></A
><H3
>Пользовательские скрипты</H3
><P
>Программа <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> поддерживает запуск пользовательских сценариев оценки производительности, позволяя заменять стандартный скрипт транзакции (описанный выше) скриптом, считываемым из файла (с параметром <TT
CLASS="OPTION"
>-f</TT
>). В этом случае <SPAN
CLASS="QUOTE"
>"транзакцией"</SPAN
> считается одно выполнение данного скрипта. Вы можете задействовать даже несколько скриптов (добавив несколько параметров <TT
CLASS="OPTION"
>-f</TT
>); в этом случае каждый раз, когда клиентский сеанс начинает новую транзакцию, выбирается случайный скрипт.</P
><P
>Файл скрипта должен содержать по одной команде SQL в строке; многострочные команды SQL не поддерживаются. Пустые строки и строки, начинающиеся с <TT
CLASS="LITERAL"
>--</TT
>, игнорируются. В строках скрипта также могут содержаться <SPAN
CLASS="QUOTE"
>"метакоманды"</SPAN
>, которые обрабатывает сама программа <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
>, как описано ниже.</P
><P
>Для файлов скриптов реализован простой механизм подстановки переменных. Переменные можно задать в командной строке параметрами <TT
CLASS="OPTION"
>-D</TT
>, описанными выше, или метакомандами, рассматриваемыми ниже. Помимо переменных, которые можно установить параметрами командной строки <TT
CLASS="OPTION"
>-D</TT
>, есть несколько автоматически устанавливаемых переменных; они перечислены в <A
HREF="pgbench.html#PGBENCH-AUTOMATIC-VARIABLES"
>Таблице F-1</A
>. Если значение этих переменных задаётся в параметре <TT
CLASS="OPTION"
>-D</TT
>, оно переопределяет автоматическое значение. Когда значение переменной определено, его можно вставить в команду SQL, написав <TT
CLASS="LITERAL"
>:</TT
><TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
>. Каждый клиентский сеанс, если их несколько, получает собственный набор переменных.</P
><DIV
CLASS="TABLE"
><A
NAME="PGBENCH-AUTOMATIC-VARIABLES"
></A
><P
><B
>Таблица F-1. Автоматические переменные</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>Переменная</TH
><TH
>Описание</TH
></TR
></THEAD
><TBODY
><TR
><TD
> <TT
CLASS="LITERAL"
>scale</TT
> </TD
><TD
>текущий коэффициент масштаба</TD
></TR
><TR
><TD
> <TT
CLASS="LITERAL"
>client_id</TT
> </TD
><TD
>уникальное число, идентифицирующее клиентский сеанс (начиная с нуля)</TD
></TR
></TBODY
></TABLE
></DIV
><P
>Метакоманды в скрипте начинаются с обратной косой черты (<TT
CLASS="LITERAL"
>\</TT
>). Аргументы метакоманд разделяются пробелами. Поддерживаемые метакоманды представлены ниже:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>\set <TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>операнд1</I
></TT
> [ <TT
CLASS="REPLACEABLE"
><I
>оператор</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>операнд2</I
></TT
> ]</TT
></DT
><DD
><P
>Устанавливает для переменной <TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
> вычисленное целочисленное значение. Каждый <TT
CLASS="REPLACEABLE"
><I
>операнд</I
></TT
> может представлять либо целочисленную константу, либо <TT
CLASS="LITERAL"
>:</TT
><TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
> (ссылку на переменную с целочисленным значением). А <TT
CLASS="REPLACEABLE"
><I
>оператор</I
></TT
> может быть следующим: <TT
CLASS="LITERAL"
>+</TT
>, <TT
CLASS="LITERAL"
>-</TT
>, <TT
CLASS="LITERAL"
>*</TT
> или <TT
CLASS="LITERAL"
>/</TT
>.</P
><P
>Пример: </P><PRE
CLASS="PROGRAMLISTING"
>\set ntellers 10 * :scale</PRE
><P></P
></DD
><DT
><TT
CLASS="LITERAL"
>\setrandom <TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>мин</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>макс</I
></TT
></TT
></DT
><DD
><P
>Устанавливает для переменной <TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
> случайное целочисленное значение от <TT
CLASS="REPLACEABLE"
><I
>мин</I
></TT
> до <TT
CLASS="REPLACEABLE"
><I
>макс</I
></TT
> включительно. Оба граничных значения могут задаваться целым числом или ссылкой <TT
CLASS="LITERAL"
>:</TT
><TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
> на переменную с целочисленным значением.</P
><P
>Пример: </P><PRE
CLASS="PROGRAMLISTING"
>\setrandom aid 1 :naccounts</PRE
><P></P
></DD
><DT
><TT
CLASS="LITERAL"
>\sleep <TT
CLASS="REPLACEABLE"
><I
>номер</I
></TT
> [ us | ms | s ]</TT
></DT
><DD
><P
>Приостанавливает выполнение скрипта на заданное число микросекунд (<TT
CLASS="LITERAL"
>us</TT
>), миллисекунд (<TT
CLASS="LITERAL"
>ms</TT
>) или секунд (<TT
CLASS="LITERAL"
>s</TT
>). Когда единицы не указываются, подразумеваются секунды. Здесь <TT
CLASS="REPLACEABLE"
><I
>число</I
></TT
> может быть целочисленной константой или ссылкой <TT
CLASS="LITERAL"
>:</TT
><TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
> на переменную с целочисленным значением.</P
><P
>Пример: </P><PRE
CLASS="PROGRAMLISTING"
>\sleep 10 ms</PRE
><P></P
></DD
><DT
><TT
CLASS="LITERAL"
>\setshell <TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>команда</I
></TT
> [ <TT
CLASS="REPLACEABLE"
><I
>аргумент</I
></TT
> ... ]</TT
></DT
><DD
><P
>Присваивает переменной <TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
> результат команды оболочки <TT
CLASS="REPLACEABLE"
><I
>команда</I
></TT
>. Эта команда должна просто выдать целочисленное значение в стандартный вывод.</P
><P
>Здесь <TT
CLASS="REPLACEABLE"
><I
>аргумент</I
></TT
> может быть либо текстовой константой, либо ссылкой <TT
CLASS="LITERAL"
>:</TT
><TT
CLASS="REPLACEABLE"
><I
>имя_переменной</I
></TT
> на значение любого типа. Если вы хотите записать <TT
CLASS="REPLACEABLE"
><I
>аргумент</I
></TT
>, начинающийся с двоеточия, добавьте дополнительное двоеточие перед указанием <TT
CLASS="REPLACEABLE"
><I
>аргумент</I
></TT
>.</P
><P
>Пример: </P><PRE
CLASS="PROGRAMLISTING"
>\setshell назначаемая_переменная команда строковый_аргумент :переменная ::строка_начинающаяся_двоеточием</PRE
><P></P
></DD
><DT
><TT
CLASS="LITERAL"
>\shell <TT
CLASS="REPLACEABLE"
><I
>команда</I
></TT
> [ <TT
CLASS="REPLACEABLE"
><I
>аргумент</I
></TT
> ... ]</TT
></DT
><DD
><P
>Действует так же, как и <TT
CLASS="LITERAL"
>\setshell</TT
>, но игнорирует результат.</P
><P
>Пример: </P><PRE
CLASS="PROGRAMLISTING"
>\shell команда строковый_аргумент :переменная ::строка_начинающаяся_двоеточием</PRE
><P></P
></DD
></DL
></DIV
><P
>В качестве примера взгляните на встроенное определение транзакции типа TPC-B: </P><PRE
CLASS="PROGRAMLISTING"
>\set nbranches :scale
\set ntellers 10 * :scale
\set naccounts 100000 * :scale
\setrandom aid 1 :naccounts
\setrandom bid 1 :nbranches
\setrandom tid 1 :ntellers
\setrandom delta -5000 5000
BEGIN;
UPDATE pgbench_accounts SET abalance = abalance + :delta WHERE aid = :aid;
SELECT abalance FROM pgbench_accounts WHERE aid = :aid;
UPDATE pgbench_tellers SET tbalance = tbalance + :delta WHERE tid = :tid;
UPDATE pgbench_branches SET bbalance = bbalance + :delta WHERE bid = :bid;
INSERT INTO pgbench_history (tid, bid, aid, delta, mtime) VALUES (:tid, :bid, :aid, :delta, CURRENT_TIMESTAMP);
END;</PRE
><P> С таким скриптом транзакция на каждой итерации будет обращаться к разным, случайно выбираемым строкам. (Этот пример показывает, почему важно, чтобы в каждом клиентском сеансе были собственные переменные &mdash; в противном случае они не будут независимо обращаться к разным строкам.)</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN126851"
></A
><H3
>Протоколирование транзакций</H3
><P
>С параметром <TT
CLASS="OPTION"
>-l</TT
>, но без <TT
CLASS="OPTION"
>--aggregate-interval</TT
>, <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> записывает в протокол время, которое ушло на выполнение каждой транзакции. Этот файл протокола будет называться <TT
CLASS="FILENAME"
>pgbench_log.<TT
CLASS="REPLACEABLE"
><I
>nnn</I
></TT
></TT
>, где <TT
CLASS="REPLACEABLE"
><I
>nnn</I
></TT
> — PID процесса pgbench. Если используется параметр <TT
CLASS="OPTION"
>-j</TT
> со значением 2 или больше, будет создано несколько рабочих потоков, и каждый будет записывать отдельный протокол. Первый рабочий процесс будет использовать файл с тем же именем, что и в стандартном случае с одним потоком, а имена остальных потоков будут называться <TT
CLASS="FILENAME"
>pgbench_log.<TT
CLASS="REPLACEABLE"
><I
>nnn</I
></TT
>.<TT
CLASS="REPLACEABLE"
><I
>mmm</I
></TT
></TT
>, где <TT
CLASS="REPLACEABLE"
><I
>mmm</I
></TT
> — последовательный номер потока, начиная с 1.</P
><P
>Протокол имеет следующий формат: </P><PRE
CLASS="SYNOPSIS"
><TT
CLASS="REPLACEABLE"
><I
>код_клиента</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>номер_транзакции</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>длительность</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>номер_файла</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>отметка_времени</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>время_мкс</I
></TT
> [<TT
CLASS="REPLACEABLE"
><I
>отставание_от_графика</I
></TT
>]</PRE
><P>, где <TT
CLASS="REPLACEABLE"
><I
>длительность</I
></TT
> — общее время, потраченное на транзакцию (в микросекундах), <TT
CLASS="REPLACEABLE"
><I
>номер_файла</I
></TT
> указывает, какой файл скрипта использовался (это полезно при указании нескольких скриптов ключами <TT
CLASS="OPTION"
>-f</TT
>), а <TT
CLASS="REPLACEABLE"
><I
>отметка_времени</I
></TT
>/<TT
CLASS="REPLACEABLE"
><I
>время_мкс</I
></TT
> — отметка времени в формате UNIX и смещение в микросекундах (из этих чисел можно получить время стандарта ISO 8601 с дробными секундами), показывающее, когда транзакция была завершена. Последнее поле, <TT
CLASS="REPLACEABLE"
><I
>отставание_от_графика</I
></TT
>, представляет разницу между запланированным временем запуска транзакции и фактическим временем запуска, в микросекундах. Оно выводится, только когда используется параметр <TT
CLASS="OPTION"
>--rate</TT
>.</P
><P
>Пример вывода выглядит так: </P><PRE
CLASS="SCREEN"
> 0 199 2241 0 1175850568 995598
 0 200 2465 0 1175850568 998079
 0 201 2513 0 1175850569 608
 0 202 2038 0 1175850569 2663</PRE
><P></P
><P
>Когда проводится длительное тестирование с большим количеством транзакций, файлы протоколов могут быть очень объёмными. Чтобы в них записывалась только случайная выборка транзакций, можно запустить команду с параметром <TT
CLASS="OPTION"
>--sampling-rate</TT
>.</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN126885"
></A
><H3
>Протоколирование с агрегированием</H3
><P
>С параметром <TT
CLASS="OPTION"
>--aggregate-interval</TT
> протоколы имеют несколько иной формат: </P><PRE
CLASS="SYNOPSIS"
><TT
CLASS="REPLACEABLE"
><I
>начало_интервала</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>число_транзакций</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>сумма_длительности</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>сумма_длительности_2</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>мин_длительность</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>макс_длительность</I
></TT
> [<TT
CLASS="REPLACEABLE"
><I
>сумма_задержки</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>сумма_задержки_2</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>мин_задержка</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>макс_задержка</I
></TT
>]</PRE
><P> Здесь <TT
CLASS="REPLACEABLE"
><I
>начало_интервала</I
></TT
> — начальное время интервала (в формате времени UNIX), <TT
CLASS="REPLACEABLE"
><I
>число_транзакций</I
></TT
> — количество транзакций в данном интервале, <TT
CLASS="REPLACEABLE"
><I
>сумма_длительности</I
></TT
> — суммарная длительность транзакций (что позволяет легко вычислить среднюю длительность). Следующее поле, <TT
CLASS="REPLACEABLE"
><I
>сумма_длительности_2</I
></TT
> содержит сумму квадратов длительностей. Последние два поля, <TT
CLASS="REPLACEABLE"
><I
>мин_длительность</I
></TT
> и <TT
CLASS="REPLACEABLE"
><I
>макс_длительность</I
></TT
>, представляют минимальную и максимальную длительность транзакций в данном интервале. Интервал, в котором засчитывается транзакция, определяется временем её фиксации. Последние четыре поля, <TT
CLASS="REPLACEABLE"
><I
>сумма_задержки</I
></TT
>, <TT
CLASS="REPLACEABLE"
><I
>сумма_задержки_2</I
></TT
>, <TT
CLASS="REPLACEABLE"
><I
>мин_задержка</I
></TT
> и <TT
CLASS="REPLACEABLE"
><I
>макс_задержка</I
></TT
>, присутствуют, только если применяется параметр --rate. Они отражают время, на которое задерживается очередная транзакция, ожидая завершения предыдущей, то есть разницу между временем фактического запуска и запланированным временем.</P
><P
>Пример вывода: </P><PRE
CLASS="SCREEN"
>1345828501 5601 1542744 483552416 61 2573
1345828503 7884 1979812 565806736 60 1479
1345828505 7208 1979422 567277552 59 1391
1345828507 7685 1980268 569784714 60 1398
1345828509 7073 1979779 573489941 236 1411</PRE
><P></P
><P
>Заметьте, что простой протокол (без агрегирования) содержит номера подключаемых файлов скриптов, в отличие от протокола с агрегированием. Таким образом, если вам нужны подобные сведения, но в разрезе скриптов, вам придётся агрегировать данные самостоятельно.</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN126913"
></A
><H3
>Время ожидания по операторам</H3
><P
>С параметром <TT
CLASS="OPTION"
>-r</TT
> программа <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> учитывает время выполнения каждого оператора каждым клиентом. Затем по завершении тестирования она выводит среднее по всем значениям как время ожидания каждого оператора.</P
><P
>Со стандартным скриптом вывод будет примерно таким: </P><PRE
CLASS="SCREEN"
>starting vacuum...end.
transaction type: TPC-B (sort of)
scaling factor: 1
query mode: simple
number of clients: 10
number of threads: 1
number of transactions per client: 1000
number of transactions actually processed: 10000/10000
tps = 618.764555 (including connections establishing)
tps = 622.977698 (excluding connections establishing)
statement latencies in milliseconds:
        0.004386        \set nbranches 1 * :scale
        0.001343        \set ntellers 10 * :scale
        0.001212        \set naccounts 100000 * :scale
        0.001310        \setrandom aid 1 :naccounts
        0.001073        \setrandom bid 1 :nbranches
        0.001005        \setrandom tid 1 :ntellers
        0.001078        \setrandom delta -5000 5000
        0.326152        BEGIN;
        0.603376        UPDATE pgbench_accounts SET abalance = abalance + :delta WHERE aid = :aid;
        0.454643        SELECT abalance FROM pgbench_accounts WHERE aid = :aid;
        5.528491        UPDATE pgbench_tellers SET tbalance = tbalance + :delta WHERE tid = :tid;
        7.335435        UPDATE pgbench_branches SET bbalance = bbalance + :delta WHERE bid = :bid;
        0.371851        INSERT INTO pgbench_history (tid, bid, aid, delta, mtime) VALUES (:tid, :bid, :aid, :delta, CURRENT_TIMESTAMP);
        1.212976        END;</PRE
><P></P
><P
>Если задействуется несколько файлов скриптов, средние значения выводятся отдельно для каждого файла.</P
><P
>Учтите, что сбор дополнительных временных показателей влечёт некоторые издержки и приводит к снижению средней скорости и, как результат, падению TPS. На сколько именно снизится скорость, во многом зависит от платформы и оборудования. Хороший способ оценить, каковы эти издержки — сравнить средние значения TPS, получаемые с подсчётом времени операторов и без такого подсчёта.</P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN126922"
></A
><H3
>Полезные советы</H3
><P
>Используя <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
>, можно без особого труда получить абсолютно бессмысленные числа. Последуйте приведённым советам, чтобы получить полезные результаты.</P
><P
>Во-первых, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>никогда</I
></SPAN
> не доверяйте тестам, которые выполняются всего несколько секунд. Воспользуйтесь параметром <TT
CLASS="OPTION"
>-t</TT
> и <TT
CLASS="OPTION"
>-T</TT
> и установите время выполнения не меньше нескольких минут, чтобы избавиться от шума в средних значениях. В некоторых случаях для получения воспроизводимых результатов тестирование должно продолжаться несколько часов. Чтобы понять, были ли получены воспроизводимые значения, имеет смысл запустить тестирование несколько раз.</P
><P
>Для стандартного сценария по типу TPC-B начальный коэффициент масштаба (<TT
CLASS="OPTION"
>-s</TT
>) должен быть не меньше числа клиентов, с каким вы намерены проводить тестирование (<TT
CLASS="OPTION"
>-c</TT
>); в противном случае вы, по большому счёту, будете замерять время конкурентных изменений. Таблица <TT
CLASS="STRUCTNAME"
>pgbench_branches</TT
> содержит всего <TT
CLASS="OPTION"
>-s</TT
> строк, а каждая транзакция хочет изменить одну из них, так что если значение <TT
CLASS="OPTION"
>-c</TT
> превышает <TT
CLASS="OPTION"
>-s</TT
>, это несомненно приведёт к тому, что многие транзакции будут блокироваться другими.</P
><P
>Стандартный сценарий тестирования также довольно сильно зависит от того, сколько времени прошло с момента инициализации таблиц: накопление неактуальных строк и &laquo;мёртвого&raquo; пространства в таблицах влияет на результаты. Чтобы правильно оценить результаты, необходимо учитывать, сколько всего изменений было произведено и когда выполнялась очистка. Если же включена автоочистка, это может быть чревато непредсказуемыми изменениями оценок производительности.</P
><P
>Полезность результатов <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> также может ограничиваться тем, что тестирование с большим числом клиентских сеансов само по себе нагружает систему. Этого можно избежать, запуская <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> на другом компьютере, не на сервере баз данных, хотя при этом большое значение имеет скорость сети. Иногда, оценивая производительность одного сервера, полезно запускать даже несколько экземпляров <SPAN
CLASS="APPLICATION"
>pgbench</SPAN
> параллельно, на отдельных клиентских компьютерах.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="oid2name.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Начало</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="vacuumlo.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>oid2name</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="contrib-prog-client.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><SPAN
CLASS="APPLICATION"
>vacuumlo</SPAN
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>