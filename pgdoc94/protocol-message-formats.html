<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Форматы сообщений</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="Документация по PostgreSQL 9.4.1"
HREF="index.html"><LINK
REL="UP"
TITLE="Клиент-серверный протокол"
HREF="protocol.html"><LINK
REL="PREVIOUS"
TITLE="Типы данных в сообщениях"
HREF="protocol-message-types.html"><LINK
REL="NEXT"
TITLE="Поля сообщений с ошибками и замечаниями"
HREF="protocol-error-fields.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=UTF-8"><META
NAME="creation"
CONTENT="2016-04-12T07:56:57"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>Документация по PostgreSQL 9.4.1</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Типы данных в сообщениях"
HREF="protocol-message-types.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="protocol.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Глава 49. Клиент-серверный протокол</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Поля сообщений с ошибками и замечаниями"
HREF="protocol-error-fields.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PROTOCOL-MESSAGE-FORMATS"
>49.5. Форматы сообщений</A
></H1
><P
>В этом разделе подробно описывается формат каждого сообщения. Все сообщения помечены символами, обозначающими, какая сторона может их передавать: сервер (F), клиент (B) или обе стороны (F &amp; B). Заметьте, что хотя каждое сообщение включает счётчик байт в начале, формат сообщения разработан так, чтобы конец сообщения можно было найти, не обращаясь к счётчику байт. Это помогает проверять корректность сообщений. (Исключением является сообщение CopyData, так как оно образует часть потока данных; содержимое любого отдельного сообщения CopyData нельзя интерпретировать само по себе.)</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>AuthenticationOk (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('R')</DT
><DD
><P
>Указывает, что это сообщение представляет запрос аутентификации.</P
></DD
><DT
>Int32(8)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(0)</DT
><DD
><P
>Показывает, что проверка подлинности прошла успешно.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>AuthenticationKerberosV5 (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('R')</DT
><DD
><P
>Указывает, что это сообщение представляет запрос аутентификации.</P
></DD
><DT
>Int32(8)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(2)</DT
><DD
><P
>Указывает, что требуется проверка подлинности по протоколу Kerberos V5.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>AuthenticationCleartextPassword (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('R')</DT
><DD
><P
>Указывает, что это сообщение представляет запрос аутентификации.</P
></DD
><DT
>Int32(8)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(3)</DT
><DD
><P
>Указывает, что требуется пароль, передаваемый открытым текстом.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>AuthenticationMD5Password (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('R')</DT
><DD
><P
>Указывает, что это сообщение представляет запрос аутентификации.</P
></DD
><DT
>Int32(12)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(5)</DT
><DD
><P
>Указывает, что требуется пароль, преобразованный в хеш MD5.</P
></DD
><DT
>Byte4</DT
><DD
><P
>Значение соли, с которым должен хешироваться пароль.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>AuthenticationSCMCredential (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('R')</DT
><DD
><P
>Указывает, что это сообщение представляет запрос аутентификации.</P
></DD
><DT
>Int32(8)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(6)</DT
><DD
><P
>Указывает, что требуется сообщение с учётными данными SCM.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>AuthenticationGSS (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('R')</DT
><DD
><P
>Указывает, что это сообщение представляет запрос аутентификации.</P
></DD
><DT
>Int32(8)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(7)</DT
><DD
><P
>Указывает, что требуется проверка подлинности на базе GSSAPI.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>AuthenticationSSPI (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('R')</DT
><DD
><P
>Указывает, что это сообщение представляет запрос аутентификации.</P
></DD
><DT
>Int32(8)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(9)</DT
><DD
><P
>Указывает, что требуется проверка подлинности на базе SSPI.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>AuthenticationGSSContinue (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('R')</DT
><DD
><P
>Указывает, что это сообщение представляет запрос аутентификации.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(8)</DT
><DD
><P
>Указывает, что это сообщение содержит данные GSSAPI или SSPI.</P
></DD
><DT
>Byte<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></DT
><DD
><P
>Данные аутентификации для GSSAPI или SSPI.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>BackendKeyData (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('K')</DT
><DD
><P
>Указывает, что это сообщение содержит ключевые данные для отмены запросов. Клиент должен сохранить эти данные, если ему нужна возможность впоследствии выдавать сообщения CancelRequest.</P
></DD
><DT
>Int32(12)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32</DT
><DD
><P
>PID обслуживающего процесса.</P
></DD
><DT
>Int32</DT
><DD
><P
>Секретный ключ обслуживающего процесса.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>Bind (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('B')</DT
><DD
><P
>Указывает, что это сообщение представляет команду Bind.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>String</DT
><DD
><P
>Имя целевого портала (пустая строка выбирает безымянный портал).</P
></DD
><DT
>String</DT
><DD
><P
>Имя исходного подготовленного оператора (пустая строка выбирает безымянный подготовленный оператор).</P
></DD
><DT
>Int16</DT
><DD
><P
>Количество кодов форматов следующих параметров (обозначается ниже символом <TT
CLASS="REPLACEABLE"
><I
>C</I
></TT
>). Может быть нулевым, что показывает, что параметры отсутствуют или все параметры передаются в формате по умолчанию (текстовом); либо равняться одному, в этом случае указанный один код формата применяется ко всем параметрам; либо может равняться действительному количеству параметров.</P
></DD
><DT
>Int16[<TT
CLASS="REPLACEABLE"
><I
>C</I
></TT
>]</DT
><DD
><P
>Коды форматов параметров. В настоящее время допускаются коды ноль (текстовый формат) и один (двоичный).</P
></DD
><DT
>Int16</DT
><DD
><P
>Количество следующих значений параметров (может быть нулевым). Оно должно совпадать с количеством параметров, требующихся для запроса.</P
></DD
></DL
></DIV
><P> Затем для каждого параметра идёт следующая пара полей: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Int32</DT
><DD
><P
>Длина значения параметра, в байтах (само поле длины не считается). Может быть нулевой. В качестве особого значения, -1 представляет значение NULL. В случае с NULL никакие байты значений далее не следуют.</P
></DD
><DT
>Byte<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></DT
><DD
><P
>Значение параметра в формате, определённом соответствующим кодом формата. Переменная <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
> задаёт длину значения.</P
></DD
></DL
></DIV
><P> За последним параметром идут следующие поля: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Int16</DT
><DD
><P
>Количество кодов формата для следующих колонок результата (обозначается ниже символом <TT
CLASS="REPLACEABLE"
><I
>R</I
></TT
>). Может быть нулевым, что показывает, что колонки результата отсутствуют или для всех колонок должен использоваться формат по умолчанию (текстовый), либо равняться одному, в этом случае указанный один код формата применяется ко всем колонкам (если они есть), либо может равняться действительному количеству колонок результата запроса.</P
></DD
><DT
>Int16[<TT
CLASS="REPLACEABLE"
><I
>R</I
></TT
>]</DT
><DD
><P
>Коды форматов колонок результата. В настоящее время допускаются коды ноль (текстовый формат) и один (двоичный).</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>BindComplete (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('2')</DT
><DD
><P
>Указывает, что это сообщение, сигнализирующее о завершении Bind.</P
></DD
><DT
>Int32(4)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>CancelRequest (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Int32(16)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(80877102)</DT
><DD
><P
>Код запроса отмены. Это специально выбранное значение содержит <TT
CLASS="LITERAL"
>1234</TT
> в старших 16 битах и <TT
CLASS="LITERAL"
>5678</TT
> в младших 16 битах. (Во избежание неоднозначности этот код не должен совпадать с номером версии протокола.)</P
></DD
><DT
>Int32</DT
><DD
><P
>PID целевого обслуживающего процесса.</P
></DD
><DT
>Int32</DT
><DD
><P
>Секретный ключ целевого обслуживающего процесса.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>Close (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('C')</DT
><DD
><P
>Указывает, что это сообщение представляет команду Close.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Byte1</DT
><DD
><P
>'<TT
CLASS="LITERAL"
>S</TT
>' для закрытия подготовленного оператора, '<TT
CLASS="LITERAL"
>P</TT
>' для закрытия портала.</P
></DD
><DT
>String</DT
><DD
><P
>Имя подготовленного оператора или портала, который должен быть закрыт (пустая строка выбирает безымянный подготовленный оператор или портал).</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>CloseComplete (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('3')</DT
><DD
><P
>Указывает, что это сообщение, сигнализирующее о завершении Close.</P
></DD
><DT
>Int32(4)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>CommandComplete (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('C')</DT
><DD
><P
>Указывает, что это сообщение об успешном завершении команды.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>String</DT
><DD
><P
>Тег команды. Обычно это одно слово, обозначающее завершённую команду SQL.</P
><P
>Для команды <TT
CLASS="COMMAND"
>INSERT</TT
> в качестве тега передаётся <TT
CLASS="LITERAL"
>INSERT <TT
CLASS="REPLACEABLE"
><I
>oid</I
></TT
>
        <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
></TT
>, где <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
> — количество вставленных строк. В поле <TT
CLASS="REPLACEABLE"
><I
>oid</I
></TT
> передаётся идентификатор объекта вставленной строки, если число <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
> равно 1 и в целевой таблице содержатся OID; в противном случае вместо <TT
CLASS="REPLACEABLE"
><I
>oid</I
></TT
> передаётся 0.</P
><P
>Для команды <TT
CLASS="COMMAND"
>DELETE</TT
> в качестве тега передаётся <TT
CLASS="LITERAL"
>DELETE <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
></TT
>, где <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
> — количество удалённых строк.</P
><P
>Для команды <TT
CLASS="COMMAND"
>UPDATE</TT
> в качестве тега передаётся <TT
CLASS="LITERAL"
>UPDATE <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
></TT
>, где <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
> — количество изменённых строк.</P
><P
>Для команды <TT
CLASS="COMMAND"
>SELECT</TT
> или <TT
CLASS="COMMAND"
>CREATE TABLE AS</TT
> в качестве тега передаётся <TT
CLASS="LITERAL"
>SELECT <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
></TT
>, где <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
> — число полученных строк.</P
><P
>Для команды <TT
CLASS="COMMAND"
>MOVE</TT
> в качестве тега передаётся <TT
CLASS="LITERAL"
>MOVE <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
></TT
>, где <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
> — количество строк, на которое изменилась позиция курсора.</P
><P
>Для команды <TT
CLASS="COMMAND"
>FETCH</TT
> в качестве тега передаётся <TT
CLASS="LITERAL"
>FETCH <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
></TT
>, где <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
> — количество строк, полученное через курсор.</P
><P
>Для команды <TT
CLASS="COMMAND"
>COPY</TT
> в качестве тега передаётся <TT
CLASS="LITERAL"
>COPY <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
></TT
>, где <TT
CLASS="REPLACEABLE"
><I
>строк</I
></TT
> — количество скопированных строк. (Заметьте: число строк выводится, начиная только с <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> 8.2.)</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>CopyData (F &amp; B)</DT
><DD
><P
>                <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('d')</DT
><DD
><P
>Указывает, что в этом сообщении передаются данные <TT
CLASS="COMMAND"
>COPY</TT
>.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Byte<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></DT
><DD
><P
>Данные, образующие часть информационного потока <TT
CLASS="COMMAND"
>COPY</TT
>. Сообщения от сервера всегда соответствуют отдельным строкам данных, но сообщения, передаваемые клиентами, могут разделять поток произвольным образом.</P
></DD
></DL
></DIV
><P>
              </P
></DD
><DT
>CopyDone (F &amp; B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('c')</DT
><DD
><P
>Указывает, что это сообщение, сигнализирующее о завершении <TT
CLASS="COMMAND"
>COPY</TT
>.</P
></DD
><DT
>Int32(4)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>CopyFail (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('f')</DT
><DD
><P
>Указывает, что это сообщение, сигнализирующее об ошибке операции <TT
CLASS="COMMAND"
>COPY</TT
>.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>String</DT
><DD
><P
>Сообщение об ошибке, описывающее причину сбоя операции.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>CopyInResponse (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('G')</DT
><DD
><P
>Указывает, что это сообщение является ответом на запуск входящего копирования. Получив его, клиент начинает передавать данные на вход операции копирования (если клиент не готов к этому, он передаёт сообщение CopyFail).</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int8</DT
><DD
><P
>Значение 0 указывает, что для всей операции <TT
CLASS="COMMAND"
>COPY</TT
> применяется текстовый формат (строки разделяются символами новой строки, колонки разделяются символами-разделителями и т. д.). Значение 1 указывает, что для всей операции копирования применяется двоичный формат (подобный формату DataRow). За дополнительными сведениями обратитесь к <A
HREF="sql-copy.html"
>COPY</A
>.</P
></DD
><DT
>Int16</DT
><DD
><P
>Количество колонок в копируемых данных (ниже обозначается символом <TT
CLASS="REPLACEABLE"
><I
>N</I
></TT
>).</P
></DD
><DT
>Int16[<TT
CLASS="REPLACEABLE"
><I
>N</I
></TT
>]</DT
><DD
><P
>Коды формата для каждой колонки. В настоящее время допускаются коды ноль (текстовый формат) и один (двоичный). Если общий формат копирования — текстовый, все эти коды должны быть нулевыми.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>CopyOutResponse (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('H')</DT
><DD
><P
>Указывает, что это сообщение является ответом на запуск исходящего копирования. За этим сообщением следуют данные, исходящие со стороны сервера.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int8</DT
><DD
><P
>Значение 0 указывает, что для всей операции <TT
CLASS="COMMAND"
>COPY</TT
> применяется текстовый формат (строки разделяются символами новой строки, колонки разделяются символами-разделителями и т. д.). Значение 1 указывает, что для всей операции копирования применяется двоичный формат (подобный формату DataRow). За дополнительными сведениями обратитесь к <A
HREF="sql-copy.html"
>COPY</A
>.</P
></DD
><DT
>Int16</DT
><DD
><P
>Количество колонок в копируемых данных (ниже обозначается символом <TT
CLASS="REPLACEABLE"
><I
>N</I
></TT
>).</P
></DD
><DT
>Int16[<TT
CLASS="REPLACEABLE"
><I
>N</I
></TT
>]</DT
><DD
><P
>Коды формата для каждой колонки. В настоящее время допускаются коды ноль (текстовый формат) и один (двоичный). Если общий формат копирования — текстовый, все эти коды должны быть нулевыми.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>CopyBothResponse (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('W')</DT
><DD
><P
>Указывает, что это сообщение является ответом на запуск двустороннего копирования. Это сообщение используется только для потоковой репликации.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int8</DT
><DD
><P
>Значение 0 указывает, что для всей операции <TT
CLASS="COMMAND"
>COPY</TT
> применяется текстовый формат (строки разделяются символами новой строки, колонки разделяются символами-разделителями и т. д.). Значение 1 указывает, что для всей операции копирования применяется двоичный формат (подобный формату DataRow). За дополнительными сведениями обратитесь к <A
HREF="sql-copy.html"
>COPY</A
>.</P
></DD
><DT
>Int16</DT
><DD
><P
>Количество колонок в копируемых данных (ниже обозначается символом <TT
CLASS="REPLACEABLE"
><I
>N</I
></TT
>).</P
></DD
><DT
>Int16[<TT
CLASS="REPLACEABLE"
><I
>N</I
></TT
>]</DT
><DD
><P
>Коды формата для каждой колонки. В настоящее время допускаются коды ноль (текстовый формат) и один (двоичный). Если общий формат копирования — текстовый, все эти коды должны быть нулевыми.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>DataRow (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('D')</DT
><DD
><P
>Указывает, что в этом сообщении передаётся строка данных.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int16</DT
><DD
><P
>Количество последующих значений колонок (может быть нулевым).</P
></DD
></DL
></DIV
><P> Затем для каждой колонки идёт следующая пара полей: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Int32</DT
><DD
><P
>Длина значения колонки, в байтах (само поле длины не считается). Может быть нулевой. В качестве особого значения, -1 представляет значение NULL. В случае с NULL никакие байты значений далее не следуют.</P
></DD
><DT
>Byte<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></DT
><DD
><P
>Значение колонки в формате, определённом соответствующим кодом формата. Переменная <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
> задаёт длину значения.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>Describe (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('D')</DT
><DD
><P
>Указывает, что это сообщение представляет команду Describe.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Byte1</DT
><DD
><P
>'<TT
CLASS="LITERAL"
>S</TT
>' для получения описания подготовленного оператора, '<TT
CLASS="LITERAL"
>P</TT
>' — портала.</P
></DD
><DT
>String</DT
><DD
><P
>Имя подготовленного оператора или портала, описание которого запрашивается (пустая строка выбирает безымянный подготовленный оператор или портал).</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>EmptyQueryResponse (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('I')</DT
><DD
><P
>Указывает, что это сообщение является ответом на пустую строку запроса. (Это сообщение заменяет CommandComplete.)</P
></DD
><DT
>Int32(4)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>ErrorResponse (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('E')</DT
><DD
><P
>Указывает, что это сообщение ошибки.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P> Тело сообщения состоит из одного или нескольких определённых полей, за которыми в качестве завершающего следует нулевой байт. Поля могут идти в любом порядке. Для каждого поля передаётся: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1</DT
><DD
><P
>Код, задающий тип поля; ноль обозначает конец сообщения, после которого ничего нет. Типы полей, определённые в настоящее время, перечислены в <A
HREF="protocol-error-fields.html"
>Разделе 49.6</A
>. Так как в будущем могут появиться другие типы полей, клиенты должны просто игнорировать поля нераспознанного типа.</P
></DD
><DT
>String</DT
><DD
><P
>Значение поля.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>Execute (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('E')</DT
><DD
><P
>Указывает, что это сообщение представляет команду Execute.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>String</DT
><DD
><P
>Имя портала, подлежащего выполнению (пустая строка выбирает безымянный портал).</P
></DD
><DT
>Int32</DT
><DD
><P
>Максимальное число строк, которое должно быть возвращено, если портал содержит запрос, возвращающий строки (в противном случае игнорируется). Ноль означает <SPAN
CLASS="QUOTE"
>"без ограничения"</SPAN
>.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>Flush (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('H')</DT
><DD
><P
>Указывает, что это сообщение представляет команду Flush.</P
></DD
><DT
>Int32(4)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>FunctionCall (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('F')</DT
><DD
><P
>Указывает, что это сообщение представляет вызов функции.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32</DT
><DD
><P
>Задаёт идентификатор объекта вызываемой функции.</P
></DD
><DT
>Int16</DT
><DD
><P
>Количество кодов форматов следующих аргументов (обозначается ниже символом <TT
CLASS="REPLACEABLE"
><I
>C</I
></TT
>). Может быть нулевым, что показывает, что аргументы отсутствуют или все аргументы передаются в формате по умолчанию (текстовом); либо равняться одному, в этом случае указанный один код формата применяется ко всем аргументами, либо может равняться действительному количеству аргументов.</P
></DD
><DT
>Int16[<TT
CLASS="REPLACEABLE"
><I
>C</I
></TT
>]</DT
><DD
><P
>Коды форматов аргументов. В настоящее время допускаются коды ноль (текстовый формат) и один (двоичный).</P
></DD
><DT
>Int16</DT
><DD
><P
>Задаёт число аргументов, передаваемых функции.</P
></DD
></DL
></DIV
><P> Затем для каждого аргумента идёт следующая пара полей: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Int32</DT
><DD
><P
>Длина значения аргумента, в байтах (само поле длины не считается). Может быть нулевой. В качестве особого значения, -1 представляет значение NULL. В случае с NULL никакие байты значений далее не следуют.</P
></DD
><DT
>Byte<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></DT
><DD
><P
>Значение аргумента, в формате, определённом соответствующим кодом формата. Переменная <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
> задаёт длину значения.</P
></DD
></DL
></DIV
><P> За последним аргументом идут следующие поля: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Int16</DT
><DD
><P
>Код формата результата функции. В настоящее время допускается код ноль (текстовый формат) и один (двоичный).</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>FunctionCallResponse (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('V')</DT
><DD
><P
>Указывает, что в этом сообщении передаётся результат вызова функции.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина значения результата функции, в байтах (само поле длины не считается). Может быть нулевой. В качестве особого значения, -1 представляет значение NULL. В случае с NULL никакие байты значения далее не следуют.</P
></DD
><DT
>Byte<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></DT
><DD
><P
>Значение результата функции в формате, определённом соответствующим кодом формата. Переменная <TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
> задаёт длину значения.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>NoData (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('n')</DT
><DD
><P
>Указывает, что это сообщение сигнализирует об отсутствии данных.</P
></DD
><DT
>Int32(4)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>NoticeResponse (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('N')</DT
><DD
><P
>Указывает, что это сообщение представляет замечание.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P> Тело сообщения состоит из одного или нескольких определённых полей, за которыми в качестве завершающего следует нулевой байт. Поля могут идти в любом порядке. Для каждого поля передаётся: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1</DT
><DD
><P
>Код, задающий тип поля; ноль обозначает конец сообщения, после которого ничего нет. Типы полей, определённые в настоящее время, перечислены в <A
HREF="protocol-error-fields.html"
>Разделе 49.6</A
>. Так как в будущем могут появиться другие типы полей, клиенты должны просто игнорировать поля нераспознанного типа.</P
></DD
><DT
>String</DT
><DD
><P
>Значение поля.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>NotificationResponse (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('A')</DT
><DD
><P
>Указывает, что это сообщение представляет уведомление.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32</DT
><DD
><P
>PID обслуживающего процесса, отправляющего уведомление.</P
></DD
><DT
>String</DT
><DD
><P
>Имя канала, для которого было выдано уведомление.</P
></DD
><DT
>String</DT
><DD
><P
>Строка <SPAN
CLASS="QUOTE"
>"сообщения"</SPAN
>, сопровождающего уведомление.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>ParameterDescription (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('t')</DT
><DD
><P
>Указывает, что это сообщение представляет описание параметра.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int16</DT
><DD
><P
>Количество параметров для оператора (может быть нулевым).</P
></DD
></DL
></DIV
><P> Затем для каждого параметра передаётся: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Int32</DT
><DD
><P
>Задаёт идентификатор объекта типа данных параметра.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>ParameterStatus (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('S')</DT
><DD
><P
>Указывает, что в этом сообщении передаётся состояние параметра времени выполнения.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>String</DT
><DD
><P
>Имя параметра времени выполнения, состояние которого передаётся.</P
></DD
><DT
>String</DT
><DD
><P
>Текущее значение параметра.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>Parse (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('P')</DT
><DD
><P
>Указывает, что это сообщение представляет команду Parse.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>String</DT
><DD
><P
>Имя целевого подготовленного оператора (пустая строка выбирает безымянный подготовленный оператор).</P
></DD
><DT
>String</DT
><DD
><P
>Строка запроса, которая должна быть разобрана.</P
></DD
><DT
>Int16</DT
><DD
><P
>Количество типов параметров (может быть нулевым). Заметьте, что это значение представляет не число параметров, которые могут фигурировать в строке запроса, а число параметров, для которых клиент хочет предопределить типы.</P
></DD
></DL
></DIV
><P> Затем для каждого параметра передаётся: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Int32</DT
><DD
><P
>Задаёт идентификатор объекта типа данных параметра. Указание нулевого значения равносильно отсутствию указания типа.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>ParseComplete (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('1')</DT
><DD
><P
>Указывает, что это сообщение, сигнализирующее о завершении Parse.</P
></DD
><DT
>Int32(4)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>PasswordMessage (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('p')</DT
><DD
><P
>Указывает, что это сообщение, в котором передаётся пароль. Заметьте, что оно также применяется для передачи сообщений обмена GSSAPI и SSPI (это на самом деле ошибка проектирования, так как в этом случае сообщение может содержать произвольные двоичные данные, а не текстовую строку, оканчивающуюся нулём).</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>String</DT
><DD
><P
>Пароль (зашифрованный, если требуется).</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>PortalSuspended (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('s')</DT
><DD
><P
>Указывает, что это сообщение сигнализирует о приостановке портала. Заметьте, что оно выдаётся только при достижении ограничения числа строк, заданного в сообщении Execute.</P
></DD
><DT
>Int32(4)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>Query (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('Q')</DT
><DD
><P
>Указывает, что это сообщение представляет простой запрос.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>String</DT
><DD
><P
>Собственно строка запроса.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>ReadyForQuery (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('Z')</DT
><DD
><P
>Определяет тип сообщения. Сообщение ReadyForQuery передаётся, когда сервер готов к новому циклу запросов.</P
></DD
><DT
>Int32(5)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Byte1</DT
><DD
><P
>Индикатор текущего состояния транзакции на сервере. Возможные значения: '<TT
CLASS="LITERAL"
>I</TT
>', транзакция неактивна (вне блока транзакции), '<TT
CLASS="LITERAL"
>T</TT
>' в блоке транзакции, либо '<TT
CLASS="LITERAL"
>E</TT
>' в блоке прерванной транзакции (запросы не будут обрабатываться до завершения блока).</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>RowDescription (B)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('T')</DT
><DD
><P
>Указывает, что это сообщение представляет описание строки.</P
></DD
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int16</DT
><DD
><P
>Задаёт количество полей в строке (может быть нулевым).</P
></DD
></DL
></DIV
><P> Затем для каждого поля передаётся: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>String</DT
><DD
><P
>Имя поля.</P
></DD
><DT
>Int32</DT
><DD
><P
>Если поле связано с колонкой определённой таблицы, идентификатор объекта этой таблицы; в противном случае — ноль.</P
></DD
><DT
>Int16</DT
><DD
><P
>Если поле связано с колонкой определённой таблицы, номер атрибута для этой колонки; в противном случае — ноль.</P
></DD
><DT
>Int32</DT
><DD
><P
>Идентификатор объекта типа данных поля.</P
></DD
><DT
>Int16</DT
><DD
><P
>Размер типа данных (см. <TT
CLASS="VARNAME"
>pg_type.typlen</TT
>). Заметьте, что отрицательные значения показывают, что тип имеет переменную длину.</P
></DD
><DT
>Int32</DT
><DD
><P
>Модификатор типа (см. <TT
CLASS="VARNAME"
>pg_attribute.atttypmod</TT
>). Смысл этого модификатора зависит от типа.</P
></DD
><DT
>Int16</DT
><DD
><P
>Код формата, используемого для поля. В настоящее время допускаются коды ноль (текстовый формат) и один (двоичный). В сообщении RowDescription, возвращаемом вариацией Describe для оператора, код формата ещё не известен и всегда будет нулевым.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>SSLRequest (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Int32(8)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(80877103)</DT
><DD
><P
>Код запроса <ACRONYM
CLASS="ACRONYM"
>SSL</ACRONYM
>. Это специально выбранное значение содержит <TT
CLASS="LITERAL"
>1234</TT
> в старших 16 битах и <TT
CLASS="LITERAL"
>5679</TT
> в младших 16 битах. (Во избежание неоднозначности этот код не должен совпадать с номером версии протокола.)</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>StartupMessage (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Int32</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
><DT
>Int32(196608)</DT
><DD
><P
>Номер версии протокола. В старших 16 битах задаётся старший номер версии (3 для протокола, описываемого здесь). В младших 16 битах задаётся младший номер версии (0 для протокола, описываемого здесь).</P
></DD
></DL
></DIV
><P> За номером версии протокола следует одна или несколько пар из имени параметра и строки значения. За последней парой имя/значение должен следовать нулевой байт. Передаваться параметры могут в любом порядке. Обязательным является только параметр <TT
CLASS="LITERAL"
>user</TT
>, остальные могут отсутствовать. Каждый параметр задаётся так: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>String</DT
><DD
><P
>Имя параметра. В настоящее время принимаются имена: <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>user</TT
></DT
><DD
><P
>Имя пользователя баз данных, с которым выполняется подключение. Является обязательным, значения по умолчанию нет.</P
></DD
><DT
><TT
CLASS="LITERAL"
>database</TT
></DT
><DD
><P
>База данных, к которой выполняется подключение. По умолчанию подставляется имя пользователя.</P
></DD
><DT
><TT
CLASS="LITERAL"
>options</TT
></DT
><DD
><P
>Аргументы командной строки для обслуживающего процесса. (Этот способ считается устаревшим, теперь рекомендуется устанавливать отдельные параметры времени выполнения.)</P
></DD
></DL
></DIV
><P> В дополнение к этим параметрам можно установить любые параметры времени выполнения, значение которых может быть задано во время запуска обслуживающего процесса. Заданные значения будут применены при запуске обслуживающего процесса (после разбора аргументов командной строки, если они были переданы). Эти значения станут значениями по умолчанию в новом сеансе.</P
></DD
><DT
>String</DT
><DD
><P
>Значение параметра.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>Sync (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('S')</DT
><DD
><P
>Указывает, что это сообщение представляет команду Sync.</P
></DD
><DT
>Int32(4)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P></P
></DD
><DT
>Terminate (F)</DT
><DD
><P
><P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('X')</DT
><DD
><P
>Указывает, что это сообщение завершает сеанс.</P
></DD
><DT
>Int32(4)</DT
><DD
><P
>Длина содержимого сообщения в байтах, включая само поле длины.</P
></DD
></DL
></DIV
><P></P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="protocol-message-types.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Начало</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="protocol-error-fields.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Типы данных в сообщениях</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="protocol.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Поля сообщений с ошибками и замечаниями</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>