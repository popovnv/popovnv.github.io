<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Генетическая оптимизация запросов (GEQO) в PostgreSQL</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="Документация по PostgreSQL 9.4.1"
HREF="index.html"><LINK
REL="UP"
TITLE="Генетический оптимизатор запросов"
HREF="geqo.html"><LINK
REL="PREVIOUS"
TITLE="Генетические алгоритмы"
HREF="geqo-intro2.html"><LINK
REL="NEXT"
TITLE="Дополнительные источники информации"
HREF="geqo-biblio.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=UTF-8"><META
NAME="creation"
CONTENT="2016-04-12T07:56:57"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>Документация по PostgreSQL 9.4.1</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Генетические алгоритмы"
HREF="geqo-intro2.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="geqo.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Глава 54. Генетический оптимизатор запросов</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Дополнительные источники информации"
HREF="geqo-biblio.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GEQO-PG-INTRO"
>54.3. Генетическая оптимизация запросов (<ACRONYM
CLASS="ACRONYM"
>GEQO</ACRONYM
>) в PostgreSQL</A
></H1
><P
>Модуль <ACRONYM
CLASS="ACRONYM"
>GEQO</ACRONYM
> (Genetic Query Optimization, Генетическая оптимизация запросов) подходит к проблеме оптимизации запроса как к хорошо известной задаче коммивояжёра (<ACRONYM
CLASS="ACRONYM"
>TSP</ACRONYM
>, Traveling Salesman Problem). Возможные планы запроса кодируются числами в строковом виде. Каждая строка представляет порядок соединения одного отношения из запроса со следующим. Например, дерево соединения </P><PRE
CLASS="LITERALLAYOUT"
>   /\
  /\ 2
 /\ 3
4  1</PRE
><P> кодируется строкой целых чисел '4-1-3-2', которая означает: сначала соединить отношения '4' и '1', затем добавить '3', а затем '2', где 1, 2, 3, 4 — идентификаторы отношений внутри оптимизатора <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>.</P
><P
>Реализация <ACRONYM
CLASS="ACRONYM"
>GEQO</ACRONYM
> в <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> имеет следующие особые характеристики: <P
></P
></P><UL
COMPACT="COMPACT"
><LI
STYLE="list-style-type: disc"
><P
>Использование ГА с <I
CLASS="FIRSTTERM"
>зафиксированным состоянием</I
> (когда заменяются наименее приспособленные особи популяции, а не всё поколение) способствует быстрой сходимости к улучшенным планам запроса. Это важно для обработки запроса за приемлемое время;</P
></LI
><LI
STYLE="list-style-type: disc"
><P
>Использование <I
CLASS="FIRSTTERM"
>скрещивания с обменом рёбер</I
>, которое очень удачно минимизирует число потерянных рёбер при решении задачи коммивояжёра с применением <ACRONYM
CLASS="ACRONYM"
>ГА</ACRONYM
>;</P
></LI
><LI
STYLE="list-style-type: disc"
><P
>Мутация как генетический оператор считается устаревшей, так что для получения допустимых путей <ACRONYM
CLASS="ACRONYM"
>TSP</ACRONYM
> не требуются механизмы исправления.</P
></LI
></UL
><P></P
><P
>Части модуля <ACRONYM
CLASS="ACRONYM"
>GEQO</ACRONYM
> взяты из алгоритма Genitor, разработанного Д. Уитли.</P
><P
>В результате, модуль <ACRONYM
CLASS="ACRONYM"
>GEQO</ACRONYM
> позволяет оптимизатору запросов <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> эффективно выполнять запросы со множеством соединений, обходясь без полного перебора вариантов.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN105718"
>54.3.1. Построение возможных планов с <ACRONYM
CLASS="ACRONYM"
>GEQO</ACRONYM
></A
></H2
><P
>В процедуре планирования в <ACRONYM
CLASS="ACRONYM"
>GEQO</ACRONYM
> используется код стандартного планировщика, который строит планы сканирования отдельных отношений. Затем вырабатываются планы соединений с применением генетического подхода. Как было сказано выше, каждый план соединения представляется последовательностью чисел, определяющей порядок соединений базовых отношений. На начальной стадии код <ACRONYM
CLASS="ACRONYM"
>GEQO</ACRONYM
> просто случайным образом генерирует несколько возможных последовательностей. Затем для каждой рассматриваемой последовательности вызывается функция стандартного планировщика, оценивающая стоимость запроса в случае выбора этого порядка соединений. (Для каждого шага последовательности рассматриваются все три возможные стратегии соединения и все изначально выбранные планы сканирования отношений. Результирующей оценкой стоимости будет минимальная из всех возможных.) Последовательности соединений с наименьшей оценкой стоимости считаются <SPAN
CLASS="QUOTE"
>"более приспособленными"</SPAN
>, чем последовательности с большей оценкой. Проанализировав возможные последовательности, генетический алгоритм отбрасывает наименее приспособленные из них. Затем генерируются новые кандидаты путём объединения генов более приспособленных последовательностей &mdash; для этого выбираются случайные фрагменты известных последовательностей с низкой стоимостью, из которых складываются новые последовательности для рассмотрения. Этот процесс повторяется, пока не будет рассмотрено некоторое предопределённое количество последовательностей соединений; после этого для построения окончательного плана выбирается лучшая последовательность, найденная за всё время поиска.</P
><P
>Этот процесс по природе своей недетерминирован, вследствие случайного выбора при формировании начальной популяции и последующей <SPAN
CLASS="QUOTE"
>"мутации"</SPAN
> лучших кандидатов. Но во избежание неожиданных изменений выбранного плана, на каждом проходе алгоритм GEQO перезапускает свой генератор случайных чисел с текущим значением параметра <A
HREF="runtime-config-query.html#GUC-GEQO-SEED"
>geqo_seed</A
>. Поэтому пока значение <TT
CLASS="VARNAME"
>geqo_seed</TT
> и другие параметры GEQO остаются неизменными, для определённого запроса (и других входных данных планировщика, в частности, статистики) будет строиться один и тот же план. Если вы хотите поэкспериментировать с разными путями соединений, попробуйте изменить <TT
CLASS="VARNAME"
>geqo_seed</TT
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="GEQO-FUTURE"
>54.3.2. Будущее развитие модуля <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> <ACRONYM
CLASS="ACRONYM"
>GEQO</ACRONYM
></A
></H2
><P
>Требуется провести дополнительную работу для выбора оптимальных параметров генетического алгоритма. В файле <TT
CLASS="FILENAME"
>src/backend/optimizer/geqo/geqo_main.c</TT
>, подпрограммах <CODE
CLASS="FUNCTION"
>gimme_pool_size</CODE
> и <CODE
CLASS="FUNCTION"
>gimme_number_generations</CODE
>, мы должны найти компромиссные значения параметров, удовлетворяющие двум несовместимым требованиям: <P
></P
></P><UL
COMPACT="COMPACT"
><LI
><P
>Оптимальность плана запроса</P
></LI
><LI
><P
>Время вычисления</P
></LI
></UL
><P></P
><P
>В текущей реализации приспособленность каждой рассматриваемой последовательности соединений рассчитывается стандартным планировщиком, который каждый раз вычисляет избирательность соединения и стоимость заново. С учётом того, что различные кандидаты могут содержать общие подпоследовательности соединений, при этом будет повторяться большой объём работы. Таким образом, расчёт можно значительно ускорить, сохраняя оценки стоимости для внутренних соединений, но сложность состоит в том, чтобы уместить это состояние в разумные объёмы памяти.</P
><P
>На более общем уровне не вполне понятно, насколько уместно для оптимизации запросов использовать ГА, предназначенный для решения задачи коммивояжёра. В этой задаче стоимость, связанная с любой подстрокой (частью тура) не зависит от остального маршрута, но это определённо не так для оптимизации запросов. Таким образом, возникает вопрос, насколько эффективно скрещивание путём обмена рёбрами.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="geqo-intro2.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Начало</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="geqo-biblio.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Генетические алгоритмы</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="geqo.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Дополнительные источники информации</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>